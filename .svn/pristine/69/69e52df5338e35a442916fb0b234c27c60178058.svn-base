package kr.or.ddit.meetingRoom.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import jakarta.transaction.Transactional;
import kr.or.ddit.meetingRoom.mapper.IMeetingRoomMapper;
import kr.or.ddit.meetingRoom.service.IMeetingRoomService;
import kr.or.ddit.vo.meetingRoom.MeetingBranchVO;
import kr.or.ddit.vo.meetingRoom.MeetingReservationVO;
import kr.or.ddit.vo.meetingRoom.MeetingRoomVO;

@Service
public class MeetingRoomServiceImpl implements IMeetingRoomService {

	@Autowired
	private IMeetingRoomMapper meetingRoomMapper;
	
	// 전체 지점 목록 조회
	@Override
	public List<MeetingBranchVO> selectBranchList() {
		return meetingRoomMapper.selectBranchList();
	}
	
	// 전체 회의실 목록 조회
	@Override
	public List<MeetingRoomVO> selectMeetingRoomList(int branchId) {
		return meetingRoomMapper.selectMeetingRoomList(branchId);
	}

	// 전체 회의실 주간 예약 목록 조회
	@Override
	public List<Map<String, Object>> selectWeekBookedMeetingRoomList(Map<String, Object> params) {
		return meetingRoomMapper.selectWeekBookedMeetingRoomList(params);
	}
	
	///// 개인 회의실 예약 내용 /////
	
	// 회의실 예약 목록 조회 ( 701,702 신청, 확정건)
	@Override
	public List<MeetingReservationVO> selectReservationList(Map<String, Object> map) {
		return meetingRoomMapper.selectReservationList(map);
	}
	
	// 회의실 예약 목록 조회 ( 703, 704, 705 사용완료,취소,미방문 건 )
	@Override
	public List<Map<String, Object>> selectBookedMeetingRoomList(Map<String, Object> params) {
		return meetingRoomMapper.selectBookedMeetingRoomList(params);
	}
	
	// 회의실 예약 등록
	@Override
	@Transactional
	public void insertReservation(MeetingReservationVO reservationVO) {
		meetingRoomMapper.insertReservation(reservationVO);
		int reservationId = reservationVO.getReservationId();
		List<Integer> memberList = reservationVO.getMemberList();
		if(memberList != null && !memberList.isEmpty()) {
			for(int memberNo : memberList) {
				meetingRoomMapper.insertReservationMember(reservationId, memberNo);
			}
		}
	}

	// 회의실 예약 취소
	@Override
	public void cancelReservation(int reservationId) {
		meetingRoomMapper.cancelReservation(reservationId);
	}

	// 회의실 예약 상세정보
	@Override
	public MeetingReservationVO selectReservationDetail(int reservationId) {
		return meetingRoomMapper.selectReservationDetail(reservationId);
	}

	//회의실 예약 수정
	@Override
	@Transactional
	public void updateReservation(MeetingReservationVO reservationVO) {
		meetingRoomMapper.updateReservation(reservationVO);
		meetingRoomMapper.deleteReservationMemberList(reservationVO.getReservationId());
		List<Integer> memberList = reservationVO.getMemberList();
		int reservationId = reservationVO.getReservationId();
		if(memberList != null && !memberList.isEmpty()) {
			for(int memberNo : memberList) {
				meetingRoomMapper.insertReservationMember(reservationId, memberNo);
			}
		}
	}

	@Override
	public void insertAdminReservation(MeetingReservationVO meetingReservationVO) {
		meetingRoomMapper.insertAdminReservation(meetingReservationVO);
		
	}

	

}
