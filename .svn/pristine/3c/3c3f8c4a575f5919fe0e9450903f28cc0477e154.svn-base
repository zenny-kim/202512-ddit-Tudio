package kr.or.ddit.drive.service;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import kr.or.ddit.drive.mapper.IDriveMapper;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
public class DriveServiceImpl implements IDriveService {
	
	@Autowired
	private IDriveMapper driveMapper;
	
	/**
     * 드라이브 목록 조회 비즈니스 로직
     * @param projectNo 프로젝트 번호
     * @param folderId 클라이언트가 요청한 폴더 ID (0이면 최상위)
     * @return 목록 리스트 + 현재 폴더 ID
     */
	@Override
    public Map<String, Object> getDriveList(int projectNo, int folderId) {
        
        int targetFolderId = folderId;

        // 화면에서 최상위(0)를 요청했다면, DB에서 실제 프로젝트의 Root Folder ID를 찾아옵니다.
        if (targetFolderId == 0) {
            Integer rootId = driveMapper.selectProjectRootFolderNo(projectNo);
            
            if (rootId != null) {
                targetFolderId = rootId;
            }
        }

        List<Map<String, Object>> list = driveMapper.selectDriveItems(projectNo, targetFolderId);

        Map<String, Object> result = new HashMap<>();
        result.put("driveList", list);           // 실제 데이터 리스트
        result.put("currentFolderId", targetFolderId); // 현재 조회된 폴더 ID
        
        return result;
    }
}
