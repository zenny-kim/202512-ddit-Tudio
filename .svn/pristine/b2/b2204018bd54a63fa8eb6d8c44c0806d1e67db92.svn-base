import{r as i,j as e,a as O,l as R,W as I,Y as z,Z as U}from"./common.chunk.js";const B=({refreshTrigger:d})=>{const[c,b]=i.useState([]),[C,m]=i.useState(""),[w,k]=i.useState(""),[h,n]=i.useState([]),[N,T]=i.useState(!0),E=o=>{switch(parseInt(o)){case 201:return{text:"ìš”ì²­",color:"bg-secondary"};case 202:return{text:"ì§„í–‰",color:"bg-primary"};case 203:return{text:"ì™„ë£Œ",color:"bg-success"};case 204:return{text:"ë³´ë¥˜",color:"bg-dark"};case 205:return{text:"ì§€ì—°",color:"bg-danger"};default:return{text:"ë¯¸ì •",color:"bg-secondary"}}},t=()=>{const o=new Date,s=o.getTimezoneOffset()*6e4;return new Date(o-s).toISOString().split("T")[0]},f=i.useCallback(o=>{const s=new Date,j=new Date(s);j.setDate(s.getDate()-s.getDay());const v=[],W=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];for(let P=0;P<7;P++){const L=new Date(j);L.setDate(j.getDate()+P);const a=L.getFullYear(),g=String(L.getMonth()+1).padStart(2,"0"),D=String(L.getDate()).padStart(2,"0"),p=`${a}-${g}-${D}`,r=o.find($=>$.WORK_DATE_STR===p),S=r?r.DAILY_COUNT:0;v.push({dateStr:p,dayNum:D,dayName:W[P],count:S})}n(v)},[]),x=async(o=!1)=>{try{const s=await O.get("/tudio/dashboard/personalWork"),{list:j,titleRange:v}=s.data;b(j||[]),m(v),f(j||[]),o&&k(t())}catch(s){console.error("ê°œì¸ì—…ë¬´ ë¡œë“œ ì‹¤íŒ¨",s)}finally{T(!1)}};i.useEffect(()=>{x(!0)},[]),i.useEffect(()=>{d>0&&(console.log("â™»ï¸ [ê°œì¸ì—…ë¬´] ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹  -> ì¬ì¡°íšŒ"),x(!1))},[d]);const u=c.filter(o=>o.WORK_DATE_STR===w),l=o=>{window.location.href=`/tudio/project/detail?projectNo=${o.PROJECT_NO}&taskId=${o.WORK_ID}`},y=(o,s)=>{o.stopPropagation(),window.location.href=`/tudio/project/detail?projectNo=${s}`};return N?e.jsx("div",{className:"text-center py-4",children:e.jsx("span",{className:"spinner-border spinner-border-sm text-primary"})}):e.jsxs("div",{className:"widget-content d-flex flex-column h-100 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 pb-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"fw-bold m-0 text-dark",children:[e.jsx("i",{className:"bi bi-calendar-check text-primary me-2"}),"ê°œì¸ ì—…ë¬´"]}),e.jsx("span",{className:"badge bg-light text-secondary border",children:C})]}),e.jsx("div",{className:"d-flex justify-content-between text-center bg-light rounded p-2 mt-3 mb-3",children:h.map((o,s)=>{const j=w===o.dateStr,v=s===0?"text-danger":s===6?"text-primary":"text-dark";return e.jsxs("div",{onClick:()=>k(o.dateStr),className:`calendar-day-box flex-fill p-1 rounded cursor-pointer position-relative ${j?"bg-white shadow-sm border border-primary":""}`,children:[e.jsx("div",{className:`small ${s===0||s===6?v:"text-muted"}`,style:{fontSize:"0.7rem"},children:o.dayName}),e.jsxs("div",{className:`fw-bold mt-1 ${v}`,children:[o.dayNum,o.count>0&&e.jsxs("span",{className:"ms-1 text-primary small",style:{fontSize:"0.75rem",verticalAlign:"top"},children:["[",o.count,"]"]})]})]},o.dateStr)})})]}),e.jsxs("div",{className:"flex-grow-1 overflow-auto custom-scrollbar px-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("h6",{className:"small text-muted border-bottom pb-2 mt-3 mb-2",children:["ğŸ“… ",w," (",u.length,"ê±´)"]}),e.jsxs("div",{className:"info-icon-wrapper",children:[e.jsx("i",{className:"bi bi-info-circle text-secondary"}),e.jsxs("div",{className:"info-tooltip",children:[e.jsxs("div",{className:"d-flex align-items-center mb-1 fw-bold",children:[e.jsx("i",{className:"bi bi-bookmark-fill text-primary me-2"})," ì—…ë¬´"]}),e.jsxs("div",{className:"d-flex align-items-center mb-1 fw-bold",children:[e.jsx("i",{className:"bi bi-arrow-return-right text-muted me-2"})," ë‹¨ìœ„ ì—…ë¬´"]})]})]})]}),u.length===0?e.jsx("div",{className:"text-center text-muted py-4 small",children:"ì˜ˆì •ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("ul",{className:"list-group list-group-flush px-0 py-0",children:u.map((o,s)=>{const j=E(o.WORK_STATUS);return e.jsxs("li",{className:"list-group-item px-2 py-2 border-0 d-flex align-items-center list-group-item-action",onClick:()=>l(o),style:{cursor:"pointer"},children:[e.jsx("span",{className:"badge bg-light text-dark border me-2 text-truncate",style:{maxWidth:"180px",cursor:"pointer"},onClick:v=>y(v,o.PROJECT_NO),title:"í”„ë¡œì íŠ¸ë¡œ ì´ë™",children:o.PROJECT_NAME}),e.jsxs("div",{className:"text-truncate flex-grow-1 small fw-bold text-dark",title:o.WORK_TITLE,children:[o.WORK_TYPE==="TASK"?e.jsx("i",{className:"bi bi-bookmark-fill text-primary me-1",style:{fontSize:"0.7rem"}}):e.jsx("i",{className:"bi bi-arrow-return-right text-muted me-1",style:{fontSize:"0.7rem"}}),o.WORK_TITLE]}),e.jsx("span",{className:`badge ${j.color} ms-2`,style:{minWidth:"50px"},children:j.text})]},s)})})]}),e.jsx("div",{className:"flex-shrink-0 py-2 px-3 border-top text-end",children:e.jsxs("span",{className:"text-muted small",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"bi bi-check2-circle me-1"}),"ì˜¤ëŠ˜ ì™„ë£Œ: ",e.jsxs("span",{className:"fw-bold",children:[c.filter(o=>o.WORK_DATE_STR===t()&&o.WORK_STATUS==203).length,"ê±´"]})]})})]})},F=({refreshTrigger:d})=>{const[c,b]=i.useState({stats:{PENDING_COUNT:0,CONFIRM_COUNT:0,APPROVE_COUNT:0,REJECT_COUNT:0,WAIT_COUNT:0,PROG_COUNT:0,APPROVED_COUNT:0},myDrafts:[],toApprove:[],isClient:!1}),[C,m]=i.useState(!1),[w,k]=i.useState(null),[h,n]=i.useState(null),N=async()=>{try{const j=(await O.get("/tudio/dashboard/approval/data")).data||{},v=j.isClient;b({stats:j.stats||{},myDrafts:j.myDrafts||[],toApprove:j.toApprove||[],isClient:v})}catch(s){console.error("ê²°ì¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",s)}finally{m(!1)}};i.useEffect(()=>{N()},[]),i.useEffect(()=>{d>0&&(console.log("â™»ï¸ [ì „ìê²°ì¬] ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹  -> ì¬ì¡°íšŒ"),N())},[d]);const T=s=>{window.location.href=`/tudio/approval/detail?no=${s}`},E=(s,j)=>{s.stopPropagation(),T(j)};let t=[],f="",x="";c.isClient?(f="ê²°ì¬ ê¸°ì•ˆ",t=c.toApprove,h==="PENDING"&&(t=t.filter(s=>s.documentStatus===607)),h==="CONFIRM"&&(t=t.filter(s=>s.documentStatus===608)),h==="APPROVE"&&(t=t.filter(s=>s.documentStatus===609)),h==="REJECT"&&(t=t.filter(s=>s.documentStatus===610)),x=h?"í•´ë‹¹ ìƒíƒœì˜ ê¸°ì•ˆì„œê°€ ì—†ìŠµë‹ˆë‹¤.":"ìš”ì²­ëœ ê²°ì¬ ê¸°ì•ˆì„œê°€ ì—†ìŠµë‹ˆë‹¤."):(f="ê¸°ì•ˆ í˜„í™©",t=c.myDrafts,h==="WAIT"&&(t=t.filter(s=>s.documentStatus===611)),h==="PROG"&&(t=t.filter(s=>s.documentStatus===612)),h==="REJECT"&&(t=t.filter(s=>s.documentStatus===614)),h==="APPROVED"&&(t=t.filter(s=>s.documentStatus===613)),x=h?"í•´ë‹¹ ìƒíƒœì˜ ê¸°ì•ˆì„œê°€ ì—†ìŠµë‹ˆë‹¤.":"ì‘ì„±í•œ ê¸°ì•ˆì„œê°€ ì—†ìŠµë‹ˆë‹¤.");const u=s=>{n(h===s?null:s)},l=s=>{const j=parseInt(s),v={minWidth:"60px"};switch(j){case 607:return e.jsx("span",{className:"badge bg-danger rounded-pill",style:v,children:"ë¯¸ê²°"});case 608:return e.jsx("span",{className:"badge bg-primary rounded-pill",style:v,children:"í™•ì¸"});case 609:return e.jsx("span",{className:"badge bg-success rounded-pill",style:v,children:"ìŠ¹ì¸"});case 610:return e.jsx("span",{className:"badge bg-secondary rounded-pill",style:v,children:"ë°˜ë ¤"});case 611:return e.jsx("span",{className:"badge bg-secondary rounded-pill",style:v,children:"ìŠ¹ì¸ëŒ€ê¸°"});case 612:return e.jsx("span",{className:"badge bg-primary rounded-pill",style:v,children:"ì§„í–‰ì¤‘"});case 613:return e.jsx("span",{className:"badge bg-success rounded-pill",style:v,children:"ìµœì¢…ìŠ¹ì¸"});case 614:return e.jsx("span",{className:"badge bg-danger rounded-pill",style:v,children:"ë°˜ë ¤"});case 615:return e.jsx("span",{className:"badge bg-pending rounded-pill",style:v,children:"íšŒìˆ˜"});case 616:return e.jsx("span",{className:"badge bg-light text-dark border rounded-pill",style:v,children:"ì„ì‹œë³´ê´€"});default:return e.jsx("span",{className:"badge bg-light text-dark border rounded-pill",style:v,children:"-"})}},y=s=>{switch(parseInt(s)){case 601:return"ìì›/ì¸ë ¥ ìš”ì²­";case 602:return"ì¼ì •ë³€ê²½ ìš”ì²­";case 603:return"ì˜ˆì‚°ì¡°ì • ìš”ì²­";case 604:return"ê²€ìˆ˜ë°ë³´ê³ ";case 605:return"ìµœì¢…ì™„ë£Œë³´ê³ ";case 606:return"ê¸°íƒ€";default:return"ì¼ë°˜ê¸°ì•ˆ"}},o=c.isClient?c.toApprove.length:c.myDrafts.length;return C?e.jsx("div",{className:"text-center py-4",children:e.jsx("span",{className:"spinner-border spinner-border-sm text-primary"})}):e.jsxs("div",{className:"widget-content d-flex flex-column h-100 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"fw-bold m-0 text-dark",children:[e.jsx("i",{className:"bi bi-file-earmark-check-fill me-2 text-success"}),f]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("span",{className:"badge bg-light text-secondary border",children:[o,"ê±´"]}),e.jsx("a",{href:"/tudio/approval/list",className:"text-muted small text-decoration-none ms-1",title:"ë”ë³´ê¸°",children:e.jsx("i",{className:"bi bi-plus-lg"})})]})]}),e.jsx("div",{className:"flex-shrink-0 d-flex border-bottom border-top text-center py-2 bg-light small mx-3 rounded mb-2",children:c.isClient?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${h==="PENDING"?"active":""}`,onClick:()=>u("PENDING"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ë¯¸ê²°"}),e.jsx("strong",{className:"text-danger",children:c.stats.PENDING_COUNT||0})]}),e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${h==="CONFIRM"?"active":""}`,onClick:()=>u("CONFIRM"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"í™•ì¸"}),e.jsx("strong",{className:"text-primary",children:c.stats.CONFIRM_COUNT||0})]}),e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${h==="APPROVE"?"active":""}`,onClick:()=>u("APPROVE"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ìŠ¹ì¸"}),e.jsx("strong",{className:"text-success",children:c.stats.APPROVE_COUNT||0})]}),e.jsxs("div",{className:`flex-fill py-2 stats-item ${h==="REJECT"?"active":""}`,onClick:()=>u("REJECT"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ë°˜ë ¤"}),e.jsx("strong",{className:"text-secondary",children:c.stats.REJECT_COUNT||0})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${h==="WAIT"?"active":""}`,onClick:()=>u("WAIT"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ëŒ€ê¸°"}),e.jsx("strong",{className:"text-secondary",children:c.stats.WAIT_COUNT||0})]}),e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${h==="PROG"?"active":""}`,onClick:()=>u("PROG"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ì§„í–‰"}),e.jsx("strong",{className:"text-primary",children:c.stats.PROG_COUNT||0})]}),e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${h==="REJECT"?"active":""}`,onClick:()=>u("REJECT"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ë°˜ë ¤"}),e.jsx("strong",{className:"text-danger",children:c.stats.REJECT_COUNT||0})]}),e.jsxs("div",{className:`flex-fill py-2 stats-item ${h==="APPROVED"?"active":""}`,onClick:()=>u("APPROVED"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ìŠ¹ì¸"}),e.jsx("strong",{className:"text-success",children:c.stats.APPROVED_COUNT||0})]})]})}),e.jsx("div",{className:"flex-grow-1 overflow-y-auto custom-scrollbar px-3",style:{minHeight:0},children:t.length===0?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-75 text-muted small",children:[e.jsx("i",{className:"bi bi-inbox fs-4 mb-2 opacity-50"}),e.jsx("span",{children:x})]}):e.jsx("ul",{className:"list-group list-group-flush pb-2",children:t.map(s=>e.jsxs("li",{className:"list-group-item list-group-item-action py-2 px-2 border-bottom d-flex justify-content-between align-items-center cursor-pointer border-0",onClick:()=>T(s.documentNo),style:{cursor:"pointer"},children:[e.jsx("div",{className:"text-truncate me-2",style:{flex:1},children:e.jsxs("div",{className:"d-flex align-items-center mb-1",children:[e.jsx("span",{className:"badge bg-light text-dark border me-2 text-truncate",style:{fontSize:"0.6rem"},children:y(s.documentType)}),e.jsx("span",{className:"fw-bold text-dark text-truncate small me-2",title:s.documentTitle,children:s.documentTitle}),e.jsxs("span",{className:"text-muted small",style:{fontSize:"0.75rem"},children:["[",c.isClient&&e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-person me-1"}),s.drafterName," / "]}),s.documentRegdate,"]"]})]})}),e.jsx("div",{className:"flex-shrink-0",children:c.isClient&&s.documentStatus===607?e.jsxs("button",{className:"btn btn-sm btn-danger rounded-pill py-0 px-2 fw-bold d-flex align-items-center fw-bold gap-1",style:{fontSize:"0.75rem",minWidth:"60px",justifyContent:"center",color:"#fff"},onClick:j=>E(j,s.documentNo),children:[e.jsx("i",{className:"bi bi-pencil-square",style:{fontSize:"0.7rem"}}),"ê²°ì¬"]}):l(s.documentStatus)})]},s.documentNo))})}),e.jsx("div",{className:"flex-shrink-0 p-2 border-top text-end",style:{minHeight:"2rem"}})]})},K=({refreshTrigger:d})=>{const[c,b]=i.useState({stats:{ALL_COUNT:0,UNREAD_COUNT:0,READ_COUNT:0},list:[]}),[C,m]=i.useState(!1),[w,k]=i.useState("ALL"),h=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:l=>{l.addEventListener("mouseenter",R.stopTimer),l.addEventListener("mouseleave",R.resumeTimer)}}),n=async()=>{try{const y=(await O.get("/tudio/dashboard/alarm")).data||{};b({stats:y.stats||{ALL_COUNT:0,UNREAD_COUNT:0,READ_COUNT:0},list:Array.isArray(y.list)?y.list:[]})}catch(l){console.error("ì•Œë¦¼ ë¡œë“œ ì‹¤íŒ¨",l)}finally{m(!1)}};i.useEffect(()=>{n()},[]),i.useEffect(()=>{d>0&&(console.log("â™»ï¸ Alarm ë¦¬ìŠ¤íŠ¸ ê°±ì‹ "),n())},[d]);const N=l=>{if(!l)return"-";const y=new Date(l),o=String(y.getFullYear()).slice(-2),s=String(y.getMonth()+1).padStart(2,"0"),j=String(y.getDate()).padStart(2,"0");return`${o}.${s}.${j}`},T=async(l,y)=>{l.stopPropagation();try{await O.post("/tudio/noti/toggle",{notiNo:y}),n()}catch(o){console.error("ì•Œë¦¼ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨",o)}},E=async(l,y)=>{if(l.stopPropagation(),(await R.fire({title:"ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ì‚­ì œ",cancelButtonText:"ì·¨ì†Œ",customClass:{popup:"small-swal"}})).isConfirmed)try{await O.post("/tudio/noti/delete",null,{params:{notiNo:y}}),n(),h.fire({icon:"success",title:"ì•Œë¦¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."})}catch{R.fire("ì‹¤íŒ¨","ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ","error")}},t=l=>{l&&(window.location.href=l)},f=l=>{k(l)};let x=c.list;w==="UNREAD"?x=c.list.filter(l=>l.isRead==="N"):w==="READ"&&(x=c.list.filter(l=>l.isRead==="Y"));let u="ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.";return w==="UNREAD"&&x.length===0&&(u="ì•ˆ ì½ì€ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤."),w==="READ"&&x.length===0&&(u="ì½ì€ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤."),C?e.jsx("div",{className:"text-center py-4",children:e.jsx("span",{className:"spinner-border spinner-border-sm text-primary"})}):e.jsxs("div",{className:"widget-content d-flex flex-column h-100 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 p-3 pb-2 d-flex justify-content-between align-items-center",children:e.jsxs("h6",{className:"fw-bold m-0 text-dark",children:[e.jsx("i",{className:"bi bi-bell-fill me-2 text-warning"}),"ì•Œë¦¼"]})}),e.jsxs("div",{className:"flex-shrink-0 d-flex border-bottom border-top text-center bg-light small mx-3 rounded mb-2 overflow-hidden",children:[e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${w==="ALL"?"active":""}`,onClick:()=>f("ALL"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ì „ì²´"}),e.jsx("strong",{className:"text-dark",children:c.stats.ALL_COUNT||0})]}),e.jsxs("div",{className:`flex-fill border-end py-2 stats-item ${w==="UNREAD"?"active":""}`,onClick:()=>f("UNREAD"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ì•ˆì½ìŒ"}),e.jsx("strong",{className:"text-danger",children:c.stats.UNREAD_COUNT||0})]}),e.jsxs("div",{className:`flex-fill py-2 stats-item ${w==="READ"?"active":""}`,onClick:()=>f("READ"),children:[e.jsx("span",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"ì½ìŒ"}),e.jsx("strong",{className:"text-secondary",children:c.stats.READ_COUNT||0})]})]}),e.jsx("div",{className:"flex-grow-1 overflow-y-auto custom-scrollbar",style:{minHeight:0},children:x.length===0?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-muted small pb-4",children:[e.jsx("i",{className:"bi bi-bell-slash fs-4 mb-2 opacity-50"}),e.jsx("span",{className:"text-center text-muted small",children:u})]}):e.jsx("ul",{className:"list-group list-group-flush",children:x.map(l=>e.jsxs("li",{className:`list-group-item list-group-item-action py-3 px-3 border-bottom-0 noti-list ${l.isRead==="N"?"bg-red-50":""}`,onClick:()=>t(l.notiUrl),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsx("div",{className:"text-truncate small",style:{maxWidth:"85%"},children:e.jsxs("span",{className:"text-muted",children:["From. ",l.senderId]})}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:N(l.notiRegdate)})]}),e.jsx("div",{className:`mb-2 small ${l.isRead==="N"?"fw-bold text-dark":"text-secondary"}`,children:l.notiMessage}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-xs btn-outline-secondary",onClick:y=>T(y,l.notiNo),title:l.isRead==="Y"?"ì•ˆì½ìŒ ì²˜ë¦¬":"ì½ìŒ ì²˜ë¦¬",children:e.jsx("i",{className:`bi ${l.isRead==="Y"?"bi-envelope":"bi-envelope-open"}`})}),e.jsx("button",{className:"btn btn-xs btn-outline-danger",onClick:y=>E(y,l.notiNo),title:"ì‚­ì œ",children:e.jsx("i",{className:"bi bi-trash"})})]})]},l.notiNo))})}),e.jsx("div",{className:"flex-shrink-0 p-2 border-top text-end",style:{minHeight:"2rem"}})]})},_=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:d=>{d.addEventListener("mouseenter",Swal.stopTimer),d.addEventListener("mouseleave",Swal.resumeTimer)}}),Y=({onProjectSelect:d,refreshTrigger:c})=>{const[b,C]=i.useState({projectList:[],isClient:!1}),[m,w]=i.useState(!0);i.useEffect(()=>{k()},[]),i.useEffect(()=>{c>0&&(console.log("â™»ï¸ ì†Œì¼“ ì‹ í˜¸ ê°ì§€: ëª©ë¡ ìƒˆë¡œê³ ì¹¨"),k())},[c]);const k=async()=>{try{const t=await O.get("/tudio/dashboard/bookmark/list");C(t.data||{projectList:[],isClient:!1})}catch(t){console.error("ë¶ë§ˆí¬ ë¡œë“œ ì‹¤íŒ¨",t)}finally{w(!1)}},h=async(t,f)=>{t.stopPropagation();const x={...b};C({...b,projectList:b.projectList.filter(u=>u.projectNo!==f)});try{const u=await O.post("/tudio/project/bookmark",{projectNo:f});if(u.data&&u.data.status==="SUCCESS")_.fire({icon:"success",title:"ë¶ë§ˆí¬ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤."}),console.log("ë¶ë§ˆí¬ í•´ì œ ì™„ë£Œ");else throw new Error("Server returned status: "+(u.data?u.data.status:"Unknown"))}catch{C(x),_.fire({icon:"error",title:"ë¶ë§ˆí¬ ë³€ê²½ ì‹¤íŒ¨"})}},n=t=>{if(!t)return"-";const f=new Date(t),x=String(f.getFullYear()).slice(-2),u=String(f.getMonth()+1).padStart(2,"0"),l=String(f.getDate()).padStart(2,"0");return`${x}.${u}.${l}`},N=(t,f)=>{const x=Number(t)||0,u=Number(f)||0;return x===0?0:Math.round(u/x*100)},T=(t,f)=>{if(!t||!f)return 0;const x=new Date(t).getTime(),u=new Date(f).getTime(),l=new Date().getTime(),y=u-x,o=l-x;if(y<=0)return 100;if(o<0)return 0;const s=Math.round(o/y*100);return s>100?100:s},E=t=>{const f="badge rounded-pill ms-1 px-2 py-1",x={fontSize:"0.75rem",padding:"0.25em 0.6em"};return t===1?e.jsx("span",{className:`${f} bg-success`,style:x,children:"ì™„ë£Œ"}):t===2?e.jsx("span",{className:`${f} bg-secondary`,style:x,children:"ì¤‘ë‹¨"}):e.jsx("span",{className:`${f} bg-primary`,style:x,children:"ì§„í–‰"})};return m?e.jsx("div",{className:"text-center py-4",children:e.jsx("span",{className:"spinner-border spinner-border-sm text-primary"})}):e.jsxs("div",{className:"widget-content d-flex flex-column h-100 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 border-bottom d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"fw-bold m-0 text-dark",children:[e.jsx("i",{className:"bi bi-bookmark-star-fill text-info me-2"}),"ë¶ë§ˆí¬ í”„ë¡œì íŠ¸"]}),e.jsx("span",{className:"badge bg-light text-secondary border",children:b.projectList.length})]}),e.jsx("div",{className:"flex-grow-1 overflow-auto custom-scrollbar",style:{minHeight:0},children:m?e.jsxs("div",{className:"d-flex justify-content-center align-items-center h-100 text-muted",children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2"})," ë¡œë”©ì¤‘..."]}):b.projectList.length===0?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-center text-muted py-5 small",children:[e.jsx("i",{className:"bi bi-star d-block fs-3 mb-2 opacity-50"}),"ë¶ë§ˆí¬í•œ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."]}):e.jsx("ul",{className:"list-group list-group-flush gap-1",children:b.projectList.map(t=>{const f=N(t.myTotalTaskCount,t.myDoneTaskCount),x=T(t.projectStartdate,t.projectEnddate);return e.jsxs("li",{className:"list-group-item list-group-item-action px-3 d-flex cursor-pointer",onClick:()=>d({projectNo:t.projectNo,projectName:t.projectName}),style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex align-items-center overflow-hidden me-2",style:{width:"35%",minWidth:0},children:[e.jsx("button",{className:"btn btn-link p-0 text-warning border-0 flex-shrink-0 me-2",style:{lineHeight:0},onClick:u=>h(u,t.projectNo),title:"ë¶ë§ˆí¬ í•´ì œ",children:e.jsx("i",{className:"bi bi-star-fill fs-6"})}),e.jsxs("div",{className:"d-flex overflow-hidden align-items-center",children:[e.jsx("div",{className:"fw-bold text-dark text-truncate",title:t.projectName,style:{fontSize:"0.9rem"},children:t.projectName}),E(t.projectStatus)]})]}),e.jsxs("div",{className:"d-flex flex-column justify-content-center border-start ps-3",style:{width:"65%"},children:[!b.isClient&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",style:{fontSize:"0.9rem"},children:[e.jsx("span",{className:"text-primary fw-bold",children:"ë‚´ ì—…ë¬´ ì§„í–‰í˜„í™©"}),e.jsxs("span",{className:"fw-bold small",children:[f,"% ",e.jsxs("span",{className:"text-muted fw-light",children:["(",t.myDoneTaskCount,"/",t.myTotalTaskCount,")"]})]})]}),e.jsx("div",{className:"progress",style:{height:"6px",backgroundColor:"#fff"},children:e.jsx("div",{className:"progress-bar bg-primary",style:{width:`${f}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",style:{fontSize:"0.9rem"},children:[e.jsx("span",{className:"text-primary fw-bold",children:"í”„ë¡œì íŠ¸ ì§„ì²™ë„"}),e.jsxs("span",{className:"text-dark small",children:[x,"%"]})]}),e.jsx("div",{className:"progress mb-1",style:{height:"4px",backgroundColor:"#fff"},children:e.jsx("div",{className:"progress-bar bg-secondary opacity-50",style:{width:`${x}%`}})}),e.jsxs("div",{className:"text-muted text-end",style:{fontSize:"0.8rem",whiteSpace:"nowrap"},children:[n(t.projectStartdate)," ~ ",n(t.projectEnddate)]})]})]})]},t.projectNo)})})}),e.jsx("div",{className:"flex-shrink-0 py-2 px-3 border-top text-end bg-light rounded-bottom",children:e.jsxs("span",{className:"text-muted small",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"ë¶ë§ˆí¬í•œ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•˜ì—¬ ",e.jsx("span",{className:"fw-bold text-primary",children:"To Do List"}),"ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."]})})]})},M=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1e3,timerProgressBar:!0,didOpen:d=>{d.addEventListener("mouseenter",R.stopTimer),d.addEventListener("mouseleave",R.resumeTimer)}}),J=({projectNo:d,projectName:c,onClearProject:b,refreshTrigger:C})=>{const[m,w]=i.useState([]),[k,h]=i.useState(!1),[n,N]=i.useState(!1),[T,E]=i.useState(""),[t,f]=i.useState(null),[x,u]=i.useState(""),[l,y]=i.useState("ALL"),o=i.useRef(null),s=i.useRef(null),j=async()=>{try{const r=await O.get("/tudio/dashboard/todo/list",{params:{projectNo:d||0}});w(r.data||[])}catch(r){console.error("íˆ¬ë‘ ë¡œë“œ ì‹¤íŒ¨",r)}finally{h(!1)}};i.useEffect(()=>{j(),N(!1),f(null),y("ALL")},[d]),i.useEffect(()=>{C>0&&(console.log("â™»ï¸ [TodoWidget] ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹ "),j())},[C]),i.useEffect(()=>{n&&o.current&&o.current.focus()},[n]),i.useEffect(()=>{t&&s.current&&s.current.focus()},[t]);const v=async()=>{if(!T.trim()){M.fire({icon:"warning",title:"ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."});return}try{(await O.post("/tudio/dashboard/todo/insert",{todoContent:T,projectNo:d||0})).data==="OK"?(M.fire({icon:"success",title:"í•  ì¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),E(""),j(),o.current&&o.current.focus()):R.fire("ì‹¤íŒ¨","ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error")}catch(r){console.error("ë“±ë¡ ì—ëŸ¬",r),R.fire("ì—ëŸ¬","ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.","error")}},W=async r=>{const S=r.todoStatus==="Y"?"N":"Y",$=[...m];w(m.map(A=>A.todoNo===r.todoNo?{...A,todoStatus:S}:A));try{const A=await O.post("/tudio/dashboard/todo/updateStatus",{todoNo:r.todoNo,todoStatus:S});if(console.log(A.data),A.status===200&&A.data==="OK")console.log("âœ… ì„±ê³µ");else throw new Error("DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (0ê±´ ìˆ˜ì •ë¨)")}catch(A){w($),console.error("ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨",A),R.fire("ì˜¤ë¥˜","ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨","error")}},P=async r=>{if((await R.fire({title:"ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",text:"ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ë„¤, ì‚­ì œí•©ë‹ˆë‹¤",cancelButtonText:"ì·¨ì†Œ",customClass:{popup:"small-swal"}})).isConfirmed)try{(await O.post("/tudio/dashboard/todo/delete",{todoNo:r})).data==="OK"?(M.fire({icon:"success",title:"ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."}),w(m.filter(A=>A.todoNo!==r))):R.fire("ì˜¤ë¥˜","ì‚­ì œ ì‹¤íŒ¨","error")}catch{R.fire("ì˜¤ë¥˜","ì„œë²„ í†µì‹  ì‹¤íŒ¨","error")}},L=r=>{f(r.todoNo),u(r.todoContent)},a=async()=>{if(!x.trim()){R.fire({icon:"warning",title:"ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."});return}try{(await O.post("/tudio/dashboard/todo/updateContent",{todoNo:t,todoContent:x})).data==="OK"?(M.fire({icon:"success",title:"ìˆ˜ì • ì™„ë£Œ"}),w(m.map(S=>S.todoNo===t?{...S,todoContent:x}:S)),f(null)):R.fire("ì‹¤íŒ¨","ìˆ˜ì • ì‹¤íŒ¨","error")}catch(r){console.error("ìˆ˜ì • ì‹¤íŒ¨",r)}},g=i.useMemo(()=>{const r=m.length,S=m.filter(A=>A.todoStatus==="Y").length,$=r-S;return{total:r,done:S,active:$}},[m]),D=i.useMemo(()=>{let r=m;return l==="ACTIVE"?r=m.filter(S=>S.todoStatus==="N"):l==="DONE"&&(r=m.filter(S=>S.todoStatus==="Y")),r},[m,l]),p=()=>k?"ë¡œë”©ì¤‘...":m.length===0?d>0?"ì´ í”„ë¡œì íŠ¸ì— í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.":"ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.":l==="ACTIVE"?"ì§„í–‰ ì¤‘ì¸ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.":l==="DONE"?"ì™„ë£Œëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.":"í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.";return e.jsxs("div",{className:"widget-content zen-folder-widget bg-white d-flex flex-column rounded shadow-sm position-relative",style:{height:"100%",width:"100%",overflow:"hidden"},children:[e.jsx("style",{children:`
                .todo-tab { cursor: pointer; transition: all 0.2s; border-top: 2px solid transparent; }
                .todo-tab:hover { background-color: #f8f9fa; }
                .todo-tab.active { background-color: #EFF6FF; color: #3B82F6; font-weight: bold;}
                .todo-tab .badge { transition: all 0.2s; }
                .todo-tab.active .badge { background-color: #3B82F6 !important; color: white !important; opacity: 1 !important; }
            `}),e.jsxs("div",{className:"folder-shape-layer",style:{position:"absolute",inset:0,zIndex:0},children:[e.jsx("div",{className:"folder-tab-todo"}),e.jsx("div",{className:"folder-body-bg"})]}),e.jsxs("div",{className:"folder-content-layer d-flex flex-column h-100 position-relative",style:{zIndex:1,paddingLeft:"6px"},children:[e.jsx("div",{className:"widget-header-wrapper flex-shrink-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center widget-header-custom",children:[e.jsxs("h6",{className:"font-weight-bold m-0 text-gray-800",style:{padding:"14px 20px"},children:[e.jsx("i",{className:"bi bi-check2-square text-primary me-2"}),"To Do List"]}),e.jsx("button",{className:"btn btn-sm btn-white bg-white shadow-sm border rounded-circle d-flex align-items-center justify-content-center",onClick:()=>{const r=!n;N(r),E(r?"ì •ê¸° ë°°í¬ê´€ë ¨ í™”ìƒë¯¸íŒ… ì§„í–‰":"")},title:"í•  ì¼ ì¶”ê°€",style:{width:"32px",height:"32px"},children:e.jsx("i",{className:`bi ${n?"bi-x-lg text-danger":"bi-plus-lg text-primary fw-bold"}`})})]})}),d>0&&e.jsxs("div",{className:"flex-shrink-0 px-3 py-2 border-bottom d-flex justify-content-between align-items-center bg-white bg-opacity-75",children:[e.jsxs("span",{className:"small fw-bold text-primary text-truncate",children:[e.jsx("i",{className:"bi bi-folder-fill me-1"}),c]}),e.jsx("button",{type:"button",className:"btn btn-xs btn-link text-secondary p-0 ms-2",onClick:b,title:"ì „ì²´ ëª©ë¡ ë³´ê¸°",children:e.jsx("i",{className:"bi bi-x-circle-fill"})})]}),n&&e.jsx("div",{className:"flex-shrink-0 px-3 mb-2 pt-2 animate-fade-in",children:e.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center bg-light border rounded p-2",children:[e.jsx("div",{className:"d-flex align-items-center w-100 me-2",children:e.jsx("input",{type:"text",ref:o,className:"form-control form-control-sm",placeholder:"í•  ì¼ ì¶”ê°€",value:T,onChange:r=>E(r.target.value),onKeyDown:r=>{r.key==="Enter"&&v(),r.key==="Escape"&&N(!1)}})}),e.jsx("button",{className:"btn btn-sm btn-primary",style:{minWidth:"50px"},onClick:v,children:"ì¶”ê°€"})]})}),e.jsx("div",{className:"flex-grow-1 overflow-auto custom-scrollbar px-0",id:`todo-list-area-${d}`,style:{minHeight:0},children:D.length===0?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-muted small pb-4",children:[e.jsx("i",{className:`bi ${l==="ACTIVE"?"bi-emoji-smile":"bi-clipboard-check"} fs-4 mb-2 opacity-50`}),e.jsx("span",{className:"mt-2",children:p()})]}):e.jsx("ul",{className:"list-group list-group-flush",children:D.map(r=>e.jsxs("li",{className:"list-group-item px-3 py-2 border-bottom-0 d-flex align-items-center group-hover-target",onMouseEnter:S=>S.currentTarget.classList.add("bg-light"),onMouseLeave:S=>S.currentTarget.classList.remove("bg-light"),children:[e.jsxs("div",{className:"form-check m-0 d-flex align-items-center flex-grow-1 text-truncate",style:{maxWidth:"80%"},children:[e.jsx("input",{className:"form-check-input cursor-pointer mt-0",type:"checkbox",id:`todoCheck${r.todoNo}`,checked:r.todoStatus==="Y",onChange:()=>W(r)}),t===r.todoNo?e.jsxs("div",{className:"d-flex ms-2 w-100 align-items-center",children:[e.jsx("input",{type:"text",ref:s,className:"form-control form-control-sm me-2",value:x,onChange:S=>u(S.target.value),onKeyDown:S=>{S.key==="Enter"&&a(),S.key==="Escape"&&f(null)}}),e.jsx("button",{className:"btn btn-sm btn-success text-nowrap",style:{minWidth:"50px"},onClick:a,children:"ì €ì¥"}),e.jsx("button",{className:"btn btn-sm btn-secondary text-nowrap",onClick:()=>f(null),children:"ì·¨ì†Œ"})]}):e.jsx("label",{className:`form-check-label ms-2 cursor-pointer text-truncate ${r.todoStatus==="Y"?"text-decoration-line-through text-muted":""}`,htmlFor:`todoCheck${r.todoNo}`,onDoubleClick:()=>L(r),style:{fontSize:"0.9rem",width:"100%"},title:r.todoContent,children:r.todoContent})]}),t!==r.todoNo&&e.jsxs("div",{className:"btn-group btn-group-sm opacity-50 group-hover-visible transition-opacity ms-auto",children:[e.jsx("button",{type:"button",className:"btn btn-link text-secondary p-0 me-2",onClick:()=>L(r),title:"ìˆ˜ì •",children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{type:"button",className:"btn btn-link text-danger p-0",onClick:()=>P(r.todoNo),title:"ì‚­ì œ",children:e.jsx("i",{className:"bi bi-trash"})})]})]},r.todoNo))})}),e.jsxs("div",{className:"flex-shrink-0 px-3 py-2 gap-2 d-flex border-top text-end",children:[e.jsxs("div",{className:`flex-fill d-flex align-items-center justify-content-center small todo-tab ${l==="ALL"?"active":"text-muted"}`,onClick:()=>y("ALL"),children:[e.jsx("span",{children:"ì „ì²´"}),e.jsx("span",{className:"badge bg-light border text-primary rounded-pill ms-1",children:g.total})]}),e.jsx("div",{className:"vr my-2 opacity-25"}),e.jsxs("div",{className:`flex-fill d-flex align-items-center justify-content-center small todo-tab ${l==="ACTIVE"?"active":"text-muted"}`,onClick:()=>y("ACTIVE"),children:[e.jsx("span",{children:"ì§„í–‰"}),e.jsx("span",{className:"badge bg-light border text-primary rounded-pill ms-1",children:g.active})]}),e.jsx("div",{className:"vr my-2 opacity-25"}),e.jsxs("div",{className:`flex-fill d-flex align-items-center justify-content-center small todo-tab ${l==="DONE"?"active":"text-muted"}`,onClick:()=>y("DONE"),children:[e.jsx("span",{children:"ì™„ë£Œ"}),e.jsx("span",{className:"badge bg-light border text-primary rounded-pill ms-1",children:g.done})]})]})]})]})},G=()=>{const[d,c]=i.useState([]);return i.useEffect(()=>{O.get("/tudio/dashboard/survey/pending").then(b=>{Array.isArray(b.data)?c(b.data):c([])}).catch(b=>{console.error("ì„¤ë¬¸ ë¡œë“œ ì‹¤íŒ¨",b),c([])})},[]),!d||d.length===0?null:e.jsxs("div",{className:"alert alert-primary d-flex align-items-center justify-content-between mb-4 shadow-sm border-0",role:"alert",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-clipboard-check-fill fs-4 me-3 text-primary"}),e.jsxs("div",{children:[e.jsxs("strong",{children:["ë¯¸ì°¸ì—¬ ì„¤ë¬¸ì´ ",d.length,"ê±´ ìˆìŠµë‹ˆë‹¤!"]}),e.jsx("div",{className:"small text-muted",children:"ì†Œì¤‘í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”."})]})]}),e.jsx("div",{className:"d-flex gap-2",children:(d||[]).slice(0,2).map(b=>e.jsxs("a",{href:`/tudio/survey/detail/${b.surveyNo}`,className:"btn btn-sm btn-light text-primary fw-bold border",children:[b.surveyTitle," ",e.jsx("i",{className:"bi bi-arrow-right ms-1"})]},b.surveyNo))})]})},V=({refreshTrigger:d})=>{const[c,b]=i.useState([]),[C,m]=i.useState(!0),w=()=>{O.get("/tudio/dashboard/notice").then(n=>{b(n.data||[])}).catch(n=>console.error("ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨",n)).finally(()=>m(!1))};i.useEffect(()=>{w()},[]),i.useEffect(()=>{d>0&&(console.log("â™»ï¸ [ê³µì§€ì‚¬í•­] ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹  -> ì¬ì¡°íšŒ"),w())},[d]);const k=n=>{window.location.href=`/tudio/notice/detail?noticeNo=${n}`},h=n=>{if(!n)return"-";const N=new Date(n),T=String(N.getFullYear()).slice(-2),E=String(N.getMonth()+1).padStart(2,"0"),t=String(N.getDate()).padStart(2,"0");return`${T}.${E}.${t}`};return C?e.jsx("div",{className:"text-center py-4",children:e.jsx("span",{className:"spinner-border spinner-border-sm text-warning"})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"widget-content d-flex flex-column h-100 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 border-bottom d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"fw-bold m-0",children:[e.jsx("i",{className:"bi bi-megaphone-fill me-2 text-warning"}),"ì‹œìŠ¤í…œ ê³µì§€ì‚¬í•­"]}),e.jsx("a",{href:"/tudio/notice/list",className:"text-muted small text-decoration-none",title:"ë”ë³´ê¸°",children:e.jsx("i",{className:"bi bi-plus-lg"})})]}),e.jsx("div",{className:"flex-grow-1 overflow-y-auto custom-scrollbar",style:{minHeight:0},children:c.length===0?e.jsxs("div",{className:"d-flex align-items-center justify-content-center h-100 text-muted small",children:[e.jsx("i",{className:"bi bi-exclamation-circle fs-4 mx-2 opacity-50"}),e.jsx("span",{children:"ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("ul",{className:"list-group list-group-flush",children:c.map(n=>e.jsxs("li",{className:"list-group-item list-group-item-action d-flex justify-content-between align-items-center px-3 py-3",children:[e.jsxs("div",{className:"d-flex align-items-center overflow-hidden me-2",style:{flex:1},children:[n.noticeFixStatus==="Y"&&e.jsx("i",{className:"bi bi-pin-angle-fill text-danger me-2 small flex-shrink-0",title:"ì¤‘ìš” ê³µì§€"}),e.jsx("span",{className:"notice-title text-dark small fw-bold text-truncate cursor-pointer",onClick:()=>k(n.noticeNo),style:{cursor:"pointer"},title:n.noticeTitle,children:n.noticeTitle}),new Date(n.noticeRegdate).toDateString()===new Date().toDateString()&&e.jsx("span",{className:"badge bg-danger rounded-pill ms-2",style:{fontSize:"0.5rem",padding:"0.2em 0.4em"},children:"New"})]}),e.jsxs("div",{className:"d-flex align-items-center flex-shrink-0",style:{fontSize:"0.75rem"},children:[e.jsxs("span",{className:"text-secondary me-2 fw-bold",children:[e.jsx("i",{className:"bi bi-person me-1 text-muted"}),n.writer||"ê´€ë¦¬ì"]}),e.jsx("span",{className:"text-muted small bg-light border px-2 py-1 rounded",children:h(n.noticeRegdate)})]})]},n.noticeNo))})}),e.jsx("div",{className:"flex-shrink-0 p-2 border-top text-end",style:{minHeight:"2rem"}})]})})},H=({refreshTrigger:d})=>{const[c,b]=i.useState([]),[C,m]=i.useState(!0),w=()=>{O.get("/tudio/dashboard/deadlineWork").then(n=>{console.log("ë§ˆê°ì„ë°• ë°ì´í„° í™•ì¸:",n.data),b(n.data||[])}).catch(n=>console.error("ë§ˆê°ì„ë°• ë¡œë“œ ì‹¤íŒ¨",n)).finally(()=>m(!1))};if(i.useEffect(()=>{w()},[]),i.useEffect(()=>{d>0&&(console.log("â™»ï¸ [ë§ˆê°ì„ë°•] ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹  -> ì¬ì¡°íšŒ"),w())},[d]),C)return e.jsx("div",{className:"text-center py-4",children:e.jsx("span",{className:"spinner-border spinner-border-sm text-danger"})});const k=n=>{const N=n<=0,T=N?"bg-danger":"bg-warning",E=N?"text-white":"text-dark";let t="";return n<0?t=`D+${Math.abs(n)}`:n===0?t="D-Day":t=`D-${n}`,e.jsx("div",{className:`${T} ${E} rounded d-flex align-items-center justify-content-center fw-bold shadow-sm`,style:{width:"50px",height:"50px",fontSize:"1rem",flexShrink:0},children:t})},h=n=>{localStorage.setItem("targetTab","task"),window.location.href=`/tudio/project/detail?projectNo=${n}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"widget-content d-flex flex-column h-100 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 border-bottom d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"fw-bold m-0 text-dark",children:[e.jsx("i",{className:"bi bi-stopwatch-fill me-2"}),"ë§ˆê° ì„ë°• ì—…ë¬´"]}),e.jsxs("span",{className:"badge bg-danger rounded-pill border",children:[c.length,"ê±´"]})]}),e.jsx("div",{className:"flex-grow-1 overflow-auto custom-scrollbar p-0",style:{minHeight:0},children:C?e.jsx("div",{className:"d-flex justify-content-center align-items-center h-100",children:e.jsx("div",{className:"spinner-border spinner-border-sm text-danger",role:"status"})}):c.length===0?e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center h-100 text-muted small py-5",children:[e.jsx("i",{className:"bi bi-check-circle fs-4 mb-2 text-success"}),e.jsx("span",{className:"small text-secondary mt-1",children:"ì¼ì£¼ì¼ ë‚´ ë§ˆê° ì˜ˆì •ì¸ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("div",{className:"d-flex flex-column px-2 py-2",style:{gap:"2"},children:c.map((n,N)=>{const T=n.taskDday<=0;return e.jsxs("div",{className:"deadline-card-item bg-light rounded p-3 d-flex align-items-center shadow-sm cursor-pointer",style:{marginBottom:"0.5rem"},onClick:()=>h(n.projectNo),children:[e.jsx("div",{className:"me-3",children:k(n.taskDday)}),e.jsxs("div",{className:"flex-grow-1 overflow-hidden",children:[e.jsxs("div",{className:"d-flex justify-content-between small text-muted mb-1",children:[e.jsxs("span",{className:"badge bg-light border text-truncate d-flex align-items-center text-primary fw-bold",children:[e.jsx("i",{className:"bi bi-folder-fill me-1 opacity-75",style:{fontSize:"0.6rem"}})," ",n.projectName]}),e.jsxs("span",{className:`fw-bold ${T?"text-danger":"text-warning"}`,style:{fontSize:"0.7rem"},children:["~ ",n.taskEnddate]})]}),e.jsx("div",{className:"fw-bold text-dark text-truncate mt-1 mb-1",style:{fontSize:"0.95rem"},title:n.taskTitle,children:n.taskTitle}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"progress flex-grow-1",style:{height:"6px",backgroundColor:"#edf2f7",borderRadius:"3px"},children:e.jsx("div",{className:`progress-bar ${T?"bg-danger":"bg-warning"}`,role:"progressbar",style:{width:`${n.taskRate}%`}})}),e.jsxs("small",{className:"ms-2 fw-bold text-muted",style:{fontSize:"0.75rem",width:"30px",textAlign:"right"},children:[n.taskRate,"%"]})]})]})]},N)})})}),e.jsx("div",{className:"p-2 border-top bg-light text-center small text-muted",children:c.length>0?e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill text-warning me-1"}),"ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ì—…ë¬´ë¶€í„° ì²˜ë¦¬í•˜ì„¸ìš”."]}):e.jsxs("span",{children:[e.jsx("i",{className:"bi bi-emoji-smile text-primary me-1"}),"ëª¨ë“  ì—…ë¬´ê°€ ì•ˆì •ì ì…ë‹ˆë‹¤."]})})]})})},Z=()=>{const[d,c]=i.useState([]),[b,C]=i.useState([]),[m,w]=i.useState(!1),k=i.useRef(null),[h,n]=i.useState({no:0,name:""}),[N,T]=i.useState({PERSONAL_WORK:0,DRAFT:0,ALARM:0,PROJECT_BOOKMARK:0,TODO:0,NOTICE:0,PROJECT_SUMMARY:0}),E=document.body.dataset.contextPath||"",t=document.body.dataset.loginNo?parseInt(document.body.dataset.loginNo,10):0,f=a=>{!a||typeof a!="object"||n({no:a.projectNo,name:a.projectName})},x=()=>{n({no:0,name:""})};i.useEffect(()=>{const a=document.getElementById("mainContent");if(a)return m?a.classList.add("dashboard-edit-mode"):a.classList.remove("dashboard-edit-mode"),()=>a.classList.remove("dashboard-edit-mode")},[m]),i.useEffect(()=>{(async()=>{try{const g=await O.get("/tudio/dashboard/layout"),D=Array.isArray(g.data)?g.data:[];c(D.filter(p=>p.widgetStatus==="Y")),C(D.filter(p=>p.widgetStatus==="N"))}catch(g){console.error("Layout fetch error",g)}})()},[]),i.useEffect(()=>{if(d.length===0)return;const a=document.querySelector(".grid-stack");if(!a||k.current)return;console.log("Grid Container Width:",a.offsetWidth);const g=I.init({column:12,cellHeight:100,margin:10,disableOneColumnMode:!0,animate:!0,float:!1,staticGrid:!m,removable:!1,children:!1,minRow:5,resizable:{handles:"n, e, s, w, nw, sw, se"}},a);return k.current=g,()=>{g&&(g.destroy(!1),k.current=null)}},[d]),i.useEffect(()=>{k.current&&(k.current.setStatic(!m),m&&setTimeout(()=>{window.dispatchEvent(new Event("resize")),console.log("Triggered window resize for GridStack")},320))},[m]);const u=(a,g)=>{a.dataTransfer.setData("widget-data",JSON.stringify(g)),a.dataTransfer.effectAllowed="copy",document.body.style.cursor="grabbing"},l=()=>{document.body.style.cursor="auto",document.querySelector(".grid-stack")?.classList.remove("drag-over")},y=a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy",a.currentTarget.classList.add("drag-over")},o=a=>{a.preventDefault(),a.currentTarget.classList.remove("drag-over"),document.body.style.cursor="auto";const g=a.dataTransfer.getData("widget-data");if(!g)return;const D=JSON.parse(g);C(p=>p.filter(r=>String(r.widgetNo)!==String(D.widgetNo))),c(p=>p.some(r=>String(r.widgetNo)===String(D.widgetNo))?p:[...p,{...D,x:0,y:0,widgetStatus:"Y",autoPosition:!0}])},s=i.useCallback(a=>{w(a)},[]),j=a=>{c(g=>{const D=g.find(p=>p.widgetNo==a);return D?(C(p=>[...p,{...D,x:0,y:0,widgetStatus:"N"}]),g.filter(p=>p.widgetNo!=a)):g})},v=async()=>{if(!k.current)return;const g=k.current.save(!1).map(p=>({widgetNo:p.id,x:p.x,y:p.y,width:p.w,height:p.h,widgetStatus:"Y"})),D=b.map(p=>({widgetNo:p.widgetNo,x:0,y:0,width:p.width,height:p.height,widgetStatus:"N"}));try{await O.post("/tudio/dashboard/layout/save",[...g,...D]),R.fire({icon:"success",title:"ì €ì¥ ì™„ë£Œ",text:"ë ˆì´ì•„ì›ƒì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",timer:1500,showConfirmButton:!1}),s(!1)}catch{R.fire("ì˜¤ë¥˜","ì €ì¥ ì‹¤íŒ¨","error")}};i.useEffect(()=>{if(!t)return;const a=new z(`${E}/ws-stomp`),g=U.over(a);return g.debug=null,g.connect({},()=>{console.log(`âœ… WebSocket Connected (Member: ${t})`),g.subscribe(`/sub/dashboard/${t}`,D=>{const r=JSON.parse(D.body).type;r&&N.hasOwnProperty(r)&&(console.log(`â™»ï¸ [${r}] ìœ„ì ¯ ê°±ì‹  ì‹ í˜¸ ìˆ˜ì‹ `),T(S=>({...S,[r]:S[r]+1})))})}),()=>{g&&g.disconnect()}},[E,t]);const W=a=>L[a]?.title||"ìœ„ì ¯",P=a=>L[a]?.icon||"bi-grid",L=i.useMemo(()=>({PERSONAL_WORK:{component:e.jsx(B,{refreshTrigger:N.PERSONAL_WORK}),title:"ê°œì¸ ì—…ë¬´",icon:"bi-calendar-week"},DRAFT:{component:e.jsx(F,{refreshTrigger:N.DRAFT}),title:"ì „ìê²°ì¬",icon:"bi-file-earmark-text"},ALARM:{component:e.jsx(K,{refreshTrigger:N.ALARM}),title:"ë¯¸í™•ì¸ ì•Œë¦¼",icon:"bi-bell-fill"},PROJECT_BOOKMARK:{component:e.jsx(Y,{onProjectSelect:f,refreshTrigger:N.PROJECT_BOOKMARK}),title:"ë¶ë§ˆí¬ í”„ë¡œì íŠ¸",icon:"bi-bookmark-star-fill"},TODO:{component:e.jsx(J,{projectNo:h.no,projectName:h.name,onClearProject:x,refreshTrigger:N.TODO}),title:"To Do List",icon:"bi-check2-square"},NOTICE:{component:e.jsx(V,{refreshTrigger:N.NOTICE}),title:"ì‹œìŠ¤í…œ ê³µì§€ì‚¬í•­",icon:"bi-megaphone-fill"},PROJECT_SUMMARY:{component:e.jsx(H,{refreshTrigger:N.PROJECT_SUMMARY}),title:"ë§ˆê° ì„ë°• ì—…ë¬´",icon:"bi-stopwatch"}}),[h,N]);return e.jsxs("div",{className:"dashboard-container",children:[e.jsx("svg",{width:"0",height:"0",style:{position:"absolute",visibility:"hidden",pointerEvents:"none"},children:e.jsx("defs",{children:e.jsxs("filter",{id:"filter-svg",children:[e.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur"}),e.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9",result:"goo"}),e.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})})}),e.jsxs("div",{className:"dashboard-content-wrapper",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center px-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"fw-bold text-primary-dark mb-2",style:{color:"#00407F"},children:"ëŒ€ì‹œë³´ë“œ"}),e.jsx("p",{className:"text-muted small m-0",children:"Tudioì™€ í•¨ê»˜ í™œê¸°ì°¨ê²Œ ì—…ë¬´ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš” !"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("div",{className:"bg-white rounded-pill px-3 py-2 d-flex align-items-center border shadow-sm gap-3",children:e.jsxs("div",{className:"form-check form-switch m-0",children:[e.jsx("input",{className:"form-check-input cursor-pointer",type:"checkbox",id:"editModeSwitch",checked:m,onChange:a=>s(a.target.checked)}),e.jsx("label",{className:"form-check-label small fw-bold ms-2 cursor-pointer",htmlFor:"editModeSwitch",children:"ìœ„ì ¯ í¸ì§‘"})]})}),m&&e.jsxs("button",{className:"btn btn-sm btn-primary rounded-pill px-3 py-2 fw-bold shadow-sm",onClick:v,children:[e.jsx("i",{className:"bi bi-check-lg me-1"})," ì €ì¥"]})]})]}),e.jsx("div",{className:"px-4",children:e.jsx(G,{})}),e.jsx("div",{className:"main-content-wrapper px-2",children:e.jsx("div",{className:"grid-stack",style:{minHeight:"600px"},onDragOver:m?y:void 0,onDrop:m?o:void 0,children:d.map(a=>e.jsx("div",{className:"grid-stack-item","gs-id":a.widgetNo,"gs-x":a.x,"gs-y":a.y,"gs-w":a.width,"gs-h":a.height,"gs-auto-position":a.autoPosition?"true":void 0,"data-type":a.widgetType,children:e.jsxs("div",{className:"grid-stack-item-content",children:[m&&e.jsx("div",{className:"btn-close-widget",onClick:()=>j(a.widgetNo),children:e.jsx("i",{className:"bi bi-x-lg"})}),L[a.widgetType]?.component]})},a.widgetNo))})})]}),e.jsxs("div",{className:`widget-drawer ${m?"open":""}`,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4 p-3",children:[e.jsxs("h5",{className:"fw-bold m-0",children:[e.jsx("i",{className:"bi bi-box-seam me-2"})," ìœ„ì ¯ ë³´ê´€í•¨"]}),e.jsx("button",{className:"btn-close",onClick:()=>s(!1)})]}),e.jsx("div",{id:"sidebar-content",className:"px-3 pb-3 h-100 overflow-auto",children:b.map(a=>e.jsx("div",{className:"sidebar-widget-item mb-3 cursor-grab","gs-id":a.widgetNo,"gs-w":a.width,"gs-h":a.height,"data-type":a.widgetType,draggable:!0,onDragStart:g=>u(g,a),onDragEnd:l,style:{cursor:"grab"},children:e.jsxs("div",{className:"grid-stack-item-content w-100",style:{pointerEvents:"none"},children:[e.jsxs("span",{className:"fw-bold text-dark small",children:[e.jsx("i",{className:`bi ${P(a.widgetType)} me-2 text-primary`}),W(a.widgetType)]}),e.jsx("i",{className:"bi bi-grip-vertical text-muted"})]})},a.widgetNo))})]})]})};export{Z as D};
