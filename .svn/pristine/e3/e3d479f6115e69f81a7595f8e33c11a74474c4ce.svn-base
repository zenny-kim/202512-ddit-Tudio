<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=126a30d2a46843ee25bc69a141aa9849&libraries=services&autoload=false""></script>
<style>
    /* 예약 페이지 전용 변수 */
    .reservation-wrap {
        --res-bg-hover: #f8fafc;
        --res-primary-light: #eff6ff;
        --res-gray: #8b95a1;
        --res-disabled: #f9fafb;
        --res-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    /* 그리드 레이아웃 */
    .res-grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    /* 카드 스타일 */
    .res-card {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        padding: 24px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    .res-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--res-shadow);
        border-color: var(--main-blue);
    }
    .res-card.active {
        border: 2px solid var(--main-blue);
        background-color: var(--res-primary-light);
    }
    .res-card.active .card-title { color: var(--main-blue); }
    .card-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; color: #333d4b; }
    .card-desc { font-size: 14px; color: var(--res-gray); }

    /* 태그 */
    .room-tags span {
        display: inline-block;
        font-size: 12px;
        background: #f1f5f9;
        color: var(--res-gray);
        padding: 4px 8px;
        border-radius: 6px;
        margin-top: 12px;
        margin-right: 4px;
    }

    /* [수정] 달력 섹션 스타일 강화 */
    .calendar-wrapper { display: none; }
    
    /* 달력 컨트롤러 (날짜 이동) */
    .calendar-header-control {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    .cal-btn {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: 0.2s;
        color: #333;
    }
    .cal-btn:hover { background: #f8f9fa; border-color: var(--main-blue); color: var(--main-blue); }
    .current-date-range { font-size: 16px; font-weight: 700; color: #333; min-width: 200px; text-align: center; cursor: pointer;}
    .current-date-range:hover { text-decoration: underline; color: var(--main-blue); }

	/* 달력 그리드 (깨짐 방지: min-width 설정 및 스크롤) */
    .week-grid-scroll {
	    overflow-x: auto; /* 화면 작으면 가로 스크롤 */
	    padding-bottom: 10px;
	    margin-top: 30px; 
	    padding-left: 20px;
	    padding-right: 20px;
	}

    .week-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        text-align: center;
        min-width: 800px; /* 최소 너비 확보하여 찌그러짐 방지 */
    }
    .day-col {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        min-height: 180px; /* 높이 약간 늘림 */
        padding: 12px;
        cursor: pointer;
        transition: 0.2s;
        display: flex;
        flex-direction: column;
    }
    .day-col:hover { border-color: var(--main-blue); background-color: #f8fbff; }
    .day-col.disabled { background: var(--res-disabled); pointer-events: none; opacity: 0.7; }
    
    .day-header { font-weight: 700; margin-bottom: 12px; display: block; font-size: 14px; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px;}
    .day-header.today { color: var(--main-blue); }

    /* 예약 바 (Bar) - 프라이버시 적용 */
    .res-bar {
        display: block;
        font-size: 11px;
        padding: 6px 8px;
        border-radius: 6px;
        margin-bottom: 6px;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .res-others { background: #f1f5f9; color: #94a3b8; } /* 회색 (예약완료) */
    .res-mine { background: #dbeafe; color: var(--main-blue); font-weight: 700; border-left: 3px solid var(--main-blue); } /* 내 예약 */

    /* 모달 */
    .modal-overlay {
        display: none;
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.4);
        z-index: 9999;
        align-items: center; justify-content: center;
        backdrop-filter: blur(2px);
    }
    .res-modal {
        background: white;
        width: 400px;
        padding: 32px;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        animation: slideUp 0.3s ease-out;
    }
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    .modal-title { font-size: 20px; font-weight: 800; margin-bottom: 24px; color: #191f28; }
    .section-divider { border-top: 1px dashed #e2e8f0; margin: 40px 0; }
    
    /* 날짜 선택기 숨김 (디자인 커스텀을 위해) */
    #hidden-date-picker {
        position: absolute; 
        opacity: 0; 
        pointer-events: none;
    }
    /* 지점 정보 섹션 스타일 */
    .branch-slider-wrap {
        position: relative;
        width: 100%;
        height: 300px; /* 높이 고정 */
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid #e2e8f0;
    }
    .slider-container {
        display: flex;
        width: 100%;
        height: 100%;
        transition: transform 0.4s ease-in-out;
    }
    .slider-img {
        min-width: 100%;
        height: 100%;
        object-fit: cover; /* 이미지가 꽉 차게 */
    }
    .slider-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.8);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #333;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        transition: 0.2s;
        z-index: 10;
    }
    .slider-btn:hover { background: white; color: var(--main-blue); }
    .slider-btn.prev { left: 15px; }
    .slider-btn.next { right: 15px; }
    
    .slider-dots {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
    }
    .dot {
        width: 8px; height: 8px;
        background: rgba(255,255,255,0.5);
        border-radius: 50%;
        cursor: pointer;
    }
    .dot.active { background: white; transform: scale(1.2); }

    .branch-map {
        width: 100%;
        height: 300px; /* 슬라이더와 높이 맞춤 */
        border-radius: 16px;
        border: 1px solid #e2e8f0;
    }
</style>

<section class="tudio-section reservation-wrap">

    <div class="tudio-section-header d-flex align-items-center justify-content-between">
        <h2 class="h5 fw-bold m-0 text-primary-dark">
            <i class="bi bi-calendar-check me-2"></i>회의실 예약
        </h2>
        <div>
            <button class="tudio-btn tudio-btn-outline" onclick="alert('내 예약 현황 페이지로 이동')">
                <i class="bi bi-journal-check"></i> 나의 예약 현황
            </button>
        </div>
    </div>

<div class="p-3">
        <h6 class="fw-bold mb-3 text-dark"><i class="bi bi-geo-alt-fill text-danger me-1"></i>지점을 선택해주세요</h6>
        
        <div class="res-grid-container" id="branch-list">
            <c:choose>
                <c:when test="${not empty branchList}">
                    <c:forEach items="${branchList}" var="branch">
	                    <div class="res-card" onclick="selectBranch(this, ${branch.branchId}, '${branch.branchName}', '${branch.branchAddr}', ${branch.fileGroupNo})">
	                        <div class="card-title">${branch.branchName}</div>
	                        <div class="card-desc">${branch.branchAddr}</div>
	                    </div>
	                </c:forEach>
                </c:when>
                <c:otherwise>
                    <div class="col-12 text-center p-4 border rounded bg-light">
                        등록된 지점 정보가 없습니다.
                    </div>
                </c:otherwise>
            </c:choose>
        </div>
		<!--  주소, 사진  -->
		
		<div id="branch-info-section" style="display:none; margin-top: 30px; margin-bottom: 30px;">
            <div class="row g-4"> <div class="col-md-6">
                    <div class="branch-slider-wrap">
                        <div class="slider-container" id="slider-images">
                            </div>
                        <button class="slider-btn prev" onclick="moveSlide(-1)"><i class="bi bi-chevron-left"></i></button>
                        <button class="slider-btn next" onclick="moveSlide(1)"><i class="bi bi-chevron-right"></i></button>
                        <div class="slider-dots" id="slider-dots"></div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div id="map" class="branch-map"></div>
                </div>
            </div>
        </div>
		
		<!-- 회의실 목록  -->
        <div id="room-section" style="display:none;">
            <div class="section-divider"></div>
            <h6 class="fw-bold mb-3 text-dark">
                <i class="bi bi-door-open-fill text-warning me-1"></i>회의실을 선택해주세요 
                <span id="selected-branch-name" class="text-primary small ms-2"></span>
            </h6>
            
            <div class="res-grid-container" id="room-grid-target">
                </div>
        </div>

        <div id="calendar-section" class="calendar-wrapper">
            <div class="section-divider"></div>
            
            <div class="d-flex flex-column align-items-center mb-4">
                <div class="calendar-header-control">
                    <button class="cal-btn" onclick="moveWeek(-1)"><i class="bi bi-chevron-left"></i></button>
                    <div class="current-date-range" id="current-week-range" onclick="document.getElementById('date-picker-trigger').showPicker()">
                        2024년 5월 3주차
                    </div>
                    <input type="date" id="date-picker-trigger" style="visibility: hidden; position: absolute;" onchange="pickDate(this.value)">
                    
                    <button class="cal-btn" onclick="moveWeek(1)"><i class="bi bi-chevron-right"></i></button>
                </div>
                <span class="small text-muted bg-light px-2 py-1 rounded">
                    <i class="bi bi-info-circle me-1"></i>예약은 09:00 ~ 18:00 가능 (최대 4시간)
                </span>
            </div>

            <div class="week-grid-scroll">
                <div class="week-grid" id="week-grid-target">
                </div>
            </div>
        </div>
    </div>
    
    
</section>

<div id="reservation-modal" class="modal-overlay">
    <div class="res-modal">
        <div class="modal-title">예약 시간 선택</div>
        <div class="alert alert-light border mb-4 d-flex align-items-center">
            <i class="bi bi-calendar3 me-2 text-primary"></i>
            <span id="modal-date-display" class="fw-bold text-dark">날짜 정보</span>
        </div>
        
        <div class="mb-3">
            <label class="form-label small fw-bold text-muted">시작 시간 (09:00 ~ 18:00)</label>
            <select class="form-select form-select-lg" id="start-time-select" onchange="updateEndTimeOptions()">
                </select>
        </div>
        <div class="mb-5">
            <label class="form-label small fw-bold text-muted">종료 시간 (최대 4시간)</label>
            <select class="form-select form-select-lg" id="end-time-select">
                <option value="">시작 시간을 먼저 선택하세요</option>
            </select>
        </div>

        <div class="d-flex gap-2">
            <button class="tudio-btn tudio-btn-outline w-50 justify-content-center" onclick="closeModal()">취소</button>
            <button class="tudio-btn tudio-btn-primary w-50 justify-content-center" onclick="confirmReservation()">
                예약하기
            </button>
        </div>
    </div>
</div>

<script>
    // === [1] 전역 변수 ===
    let currentDate = new Date();
    let map = null;       // 지도 객체
    let marker = null;    // 마커 객체
    let currentSlide = 0; // 슬라이더 현재 인덱스
    let totalSlides = 0;  // 전체 슬라이드 개수

    document.addEventListener("DOMContentLoaded", () => {
        // 초기 로딩 시 필요한 작업
    });

    // === [2] 지점 선택 로직 ===
    function selectBranch(element, branchId, branchName, branchAddr, fileGroupNo) {
        // 1. 선택 스타일 적용
        document.querySelectorAll('#branch-list .res-card').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        
        document.getElementById('selected-branch-name').innerText = '- ' + branchName;

        // 2. [중요] 지점 정보 섹션(지도+사진) 보이기
        const infoSection = document.getElementById('branch-info-section');
        infoSection.style.display = 'block';

        // 3. 지도 로드 (DB 주소 기반)
        loadMap(branchName, branchAddr);

        // 4. 슬라이더 로드 (DB 파일그룹번호 기반)
        initSlider(fileGroupNo);

        // 5. 하단 영역 초기화 (새 지점을 눌렀으므로 회의실, 달력은 다시 숨김/리셋)
        document.getElementById('calendar-section').style.display = 'none';
        document.getElementById('room-grid-target').innerHTML = '<div class="text-center w-100 py-5"><div class="spinner-border text-primary" role="status"></div></div>';
        document.getElementById('room-section').style.display = 'block';

        // 6. 회의실 목록 AJAX 호출
        fetch('/tudio/project/meetingRoom/list?branchId=' + branchId)
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                renderRooms(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('room-grid-target').innerHTML = '<p class="text-danger text-center">데이터를 불러오는 중 오류가 발생했습니다.</p>';
            });
        
        // 스크롤 부드럽게 이동
        setTimeout(() => {
            infoSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
    }

    // === [3] 카카오 지도 로드 함수 (다음 주소 API 활용) ===
    function loadMap(name, addr) {
        // [핵심] 카카오 맵이 로드된 후 실행하도록 감싸줍니다.
        kakao.maps.load(function() {
            
            var mapContainer = document.getElementById('map');
            var mapOption = {
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 임시 좌표
                level: 3 
            };

            // 지도가 없으면 생성, 있으면 리사이즈만
            if (!map) {
                map = new kakao.maps.Map(mapContainer, mapOption);
            }

            // 주소-좌표 변환 객체
            var geocoder = new kakao.maps.services.Geocoder();

            // 주소로 좌표를 검색
            geocoder.addressSearch(addr, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                    // 마커 표시
                    if(marker) marker.setMap(null); // 기존 마커 삭제
                    marker = new kakao.maps.Marker({
                        map: map,
                        position: coords
                    });

                    // [중요] 지도가 숨겨져 있다가 나올 때 깨짐 방지
                    map.relayout();
                    map.setCenter(coords);
                } else {
                    console.log("주소 검색 실패: " + addr);
                }
            });
            
        }); // end kakao.maps.load
    }

    // === [4] 이미지 슬라이더 함수 (실제 데이터 연동 준비) ===
    // === [4] 이미지 슬라이더 함수 (DB 연동 완료) ===
    function initSlider(fileGroupNo) {
        currentSlide = 0;
        const container = document.getElementById('slider-images');
        const dotsContainer = document.getElementById('slider-dots');
        
        // 1. 파일 그룹 번호가 유효하지 않으면 (0이거나 null) 기본 이미지 처리
        if (!fileGroupNo || fileGroupNo === 0) {
            console.log("이미지 없음: 기본 이미지 로드");
            const defaultImages = [
                'https://via.placeholder.com/800x400?text=No+Image+Available',
                'https://via.placeholder.com/800x400?text=Tudio+Meeting+Room'
            ];
            renderSlider(defaultImages);
            return;
        }

        // 2. 컨트롤러에 이미지 목록 요청 (AJAX)
        fetch('/tudio/project/meetingRoom/fileList?fileGroupNo=' + fileGroupNo)
            .then(response => {
                if (!response.ok) throw new Error('파일 목록 조회 실패');
                return response.json();
            })
            .then(data => { // data는 FileDetailVO의 리스트입니다.
                console.log("이미지 데이터 수신:", data);

                let imageUrls = [];
                
                if (data && data.length > 0) {
                    // DB에서 가져온 filePath를 배열에 담음
                    // data[i].filePath 에는 "/upload/meetingRoom/gangnam.jpg" 등이 들어있음
                    data.forEach(file => {
                        imageUrls.push(file.filePath); 
                    });
                } else {
                    // DB 조회는 성공했으나 파일이 없는 경우
                    imageUrls = ['https://via.placeholder.com/800x400?text=No+Image+Found'];
                }
                
                // 화면 그리기 함수 호출
                renderSlider(imageUrls);
            })
            .catch(error => {
                console.error("슬라이더 로드 에러:", error);
                // 에러 시 기본 이미지
                renderSlider(['https://via.placeholder.com/800x400?text=Error+Loading+Image']);
            });
    }

    // 슬라이더 HTML 생성 도우미 함수
    function renderSlider(images) {
        const container = document.getElementById('slider-images');
        const dotsContainer = document.getElementById('slider-dots');
        
        totalSlides = images.length;
        let imgHtml = '';
        let dotHtml = '';

        images.forEach((src, idx) => {
            // [중요] JSP 충돌 방지용 역슬래시(\) 사용
            imgHtml += `<img src="\${src}" class="slider-img" alt="Office Image">`;
            dotHtml += `<div class="dot \${idx === 0 ? 'active' : ''}" onclick="goToSlide(\${idx})"></div>`;
        });

        container.innerHTML = imgHtml;
        dotsContainer.innerHTML = dotHtml;
        updateSlidePosition();
    }

    function moveSlide(direction) {
        if(totalSlides === 0) return;
        currentSlide += direction;
        if (currentSlide < 0) currentSlide = totalSlides - 1;
        if (currentSlide >= totalSlides) currentSlide = 0;
        updateSlidePosition();
    }
    
    function goToSlide(index) {
        currentSlide = index;
        updateSlidePosition();
    }

    function updateSlidePosition() {
        const container = document.getElementById('slider-images');
        container.style.transform = `translateX(-\${currentSlide * 100}%)`;
        
        const dots = document.querySelectorAll('.dot');
        dots.forEach((dot, idx) => {
            if(idx === currentSlide) dot.classList.add('active');
            else dot.classList.remove('active');
        });
    }


    // === [5] 회의실 목록 렌더링 ===
    function renderRooms(roomList) {
        const target = document.getElementById('room-grid-target');
        target.innerHTML = ''; 

        if (!roomList || roomList.length === 0) {
            target.innerHTML = '<div class="col-12 text-center p-4 text-muted border rounded">해당 지점에 예약 가능한 회의실이 없습니다.</div>';
            return;
        }

        roomList.forEach(room => {
            // room.roomId, room.roomName 등 VO 필드명과 일치해야 함
            const html = `
                <div class="res-card" onclick="selectRoom(this, '\${room.roomName}', \${room.roomId})">
                    <div class="card-title">\${room.roomName}</div>
                    <div class="card-desc">최대 \${room.roomCapacity}인 수용</div>
                    <div class="room-tags">
                        <span><i class="bi bi-projector"></i> 빔프로젝터</span>
                        <span><i class="bi bi-easel"></i> 화이트보드</span>
                    </div>
                </div>
            `;
            target.insertAdjacentHTML('beforeend', html);
        });
    }

    // === [6] 회의실 선택 시 달력 표시 ===
    function selectRoom(element, roomName, roomId) {
        console.log("선택된 회의실 ID:", roomId); 
        
        // 1. 선택 스타일
        const allRooms = document.querySelectorAll('#room-grid-target .res-card');
        allRooms.forEach(el => el.classList.remove('active'));
        element.classList.add('active');

        // 2. [중요] 여기서 달력 섹션을 보여줍니다.
        const calSection = document.getElementById('calendar-section');
        calSection.style.display = 'block';
        
        // 3. 달력 렌더링 (현재 날짜 기준)
        renderCalendar();
        
        // 4. 스크롤 이동
        calSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // === [7] 달력 및 날짜 관련 함수들 (기존 유지) ===
    function getStartDate(d) {
        const date = new Date(d);
        const day = date.getDay(); 
        const diff = date.getDate() - day; 
        return new Date(date.setDate(diff));
    }

    function renderCalendar() {
        const grid = document.getElementById('week-grid-target');
        if (!grid) return; 
        grid.innerHTML = ''; 

        const startDate = getStartDate(currentDate);
        const today = new Date(); 
        const endDate = new Date(startDate);
        endDate.setDate(startDate.getDate() + 6);
        
        document.getElementById('current-week-range').innerText = 
            `\${startDate.getFullYear()}.\${startDate.getMonth()+1}.\${startDate.getDate()} ~ \${endDate.getMonth()+1}.\${endDate.getDate()}`;

        for (let i = 0; i < 7; i++) {
            const tempDate = new Date(startDate);
            tempDate.setDate(startDate.getDate() + i);

            const year = tempDate.getFullYear();
            const month = String(tempDate.getMonth() + 1).padStart(2, '0');
            const day = String(tempDate.getDate()).padStart(2, '0');
            const dateStr = `\${year}-\${month}-\${day}`; 
            
            const dayNames = ['일', '월', '화', '수', '목', '금', '토'];
            const dayName = dayNames[tempDate.getDay()];
            const isToday = tempDate.toDateString() === today.toDateString();
            
            const col = document.createElement('div');
            col.className = 'day-col';
            col.onclick = () => openModal(dateStr, dayName);

            let headerClass = `day-header \${isToday ? 'today' : ''}`;
            let colorStyle = "";
            if (i === 0) colorStyle = "color: #ef4444;"; 
            if (i === 6) colorStyle = "color: #3b82f6;"; 

            col.innerHTML = `<span class="\${headerClass}" style="\${colorStyle}">\${dayName} (\${day})</span>`;
            
            // [달력 내부 데이터 - 추후 예약 DB 연동 필요]
            if (i % 2 === 0) { 
                 col.innerHTML += `
                    <span class="res-bar res-others">09:00~12:00 (예약완료)</span>
                    <span class="res-bar res-others">13:00~15:00 (예약완료)</span>
                    <div class="mt-auto h-100 d-flex align-items-center justify-content-center text-muted small" style="opacity: 0.5;">
                        + 예약 가능
                    </div>
                `;
            } else { 
                col.classList.add('disabled');
                col.innerHTML += `
                    <span class="res-bar res-others">09:00~18:00 (예약완료)</span>
                    <div class="mt-auto small text-danger fw-bold"><i class="bi bi-x-circle"></i> 예약 마감</div>
                `;
            }
            grid.appendChild(col);
        }
    }

    function moveWeek(direction) {
        currentDate.setDate(currentDate.getDate() + (direction * 7));
        renderCalendar();
    }
    
    function pickDate(val) {
        if(!val) return;
        currentDate = new Date(val);
        renderCalendar();
    }

    // === [8] 모달(예약 팝업) 관련 함수 ===
    function openModal(dateStr, dayName) {
        document.getElementById('modal-date-display').innerText = `\${dateStr} (\${dayName})`;
        document.getElementById('reservation-modal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        const startSelect = document.getElementById('start-time-select');
        startSelect.innerHTML = '<option value="">선택하세요</option>';
        for(let h=9; h<=17; h++) {
            const time = String(h).padStart(2, '0') + ":00";
            startSelect.innerHTML += `<option value="\${h}">\${time}</option>`;
        }
        document.getElementById('end-time-select').innerHTML = '<option value="">시작 시간을 먼저 선택하세요</option>';
    }

    function updateEndTimeOptions() {
        const startVal = parseInt(document.getElementById('start-time-select').value);
        const endSelect = document.getElementById('end-time-select');
        endSelect.innerHTML = '';

        if (isNaN(startVal)) {
            endSelect.innerHTML = '<option value="">시작 시간을 먼저 선택하세요</option>';
            return;
        }

        const maxEnd = Math.min(startVal + 4, 18);
        for (let h = startVal + 1; h <= maxEnd; h++) {
            const time = String(h).padStart(2, '0') + ":00";
            endSelect.innerHTML += `<option value="\${h}">\${time}</option>`;
        }
    }

    function confirmReservation() {
        const start = document.getElementById('start-time-select').value;
        const end = document.getElementById('end-time-select').value;
        if(!start || !end) {
            alert("시간을 올바르게 선택해주세요.");
            return;
        }
        alert(`예약이 요청되었습니다.\n시간: \${start}:00 ~ \${end}:00`);
        closeModal();
    }

    function closeModal() {
        document.getElementById('reservation-modal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    window.onclick = function(event) {
        const modal = document.getElementById('reservation-modal');
        if (event.target == modal) closeModal();
    }

</script>