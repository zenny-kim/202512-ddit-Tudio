package kr.or.ddit.admin.survey.controller;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import kr.or.ddit.survey.service.ISurveyService;
import lombok.extern.slf4j.Slf4j;

/**
 * <pre>
 * PROJ : Tudio
 * Name : AdminSurveyController
 * DESC : 설문 관리, 목록, 결과 확인 관리자용 컨트롤러
 * </pre>
 * 
 * @author [대덕인재개발원] team1 KSJ
 * @version 1.0, 2026.01.23
 * 
 */

@Slf4j
@RestController
@RequestMapping("/tudio/admin/survey")
public class AdminSurveyController {

	@Autowired
    private ISurveyService surveyService;
	
	// 관리자 - 설문 목록 조회
	@GetMapping("/list")
    public List<Map<String, Object>> selectSurveyList() {
        log.info("AdminSurveyController - 목록 조회 요청");
        return surveyService.selectSurveyList();
    }
	
	// 관리자 - 설문 등록
	@PostMapping("/insert")
    public String insertSurveyAdmin(@RequestBody Map<String, Object> surveyMap) {
        log.info("Admin - 설문 등록 (insertSurveyAdmin) : {}", surveyMap);
        int result = surveyService.insertSurveyAdmin(surveyMap);
        return result > 0 ? "SUCCESS" : "FAIL";
    }
	
	// 관리자 - 설문 수정
	@PutMapping("/update")
    public String updateSurveyAdmin(@RequestBody Map<String, Object> surveyMap) {
        log.info("Admin - 설문 수정 (updateSurveyAdmin) : {}", surveyMap);
        int result = surveyService.updateSurveyAdmin(surveyMap);
        return result > 0 ? "SUCCESS" : "FAIL";
    }
	
	
	// 관리자 - 설문 결과/ 통계 조회
    @GetMapping("/result/{surveyNo}")
    public Map<String, Object> resultSurveyAdmin(@PathVariable int surveyNo) {
        log.info("Admin - 결과 조회 (resultSurveyAdmin) : {}", surveyNo);
        // 결과 화면은 '설문 정보(info)'와 '통계(stats)'가 같이 필요하므로 Map으로 리턴
        return surveyService.resultSurveyAdmin(surveyNo);
    }
}
