/**
 * dashboard.js
 * - GridStack.js
 */

const CONTEXT_PATH = document.body.dataset.contextPath;

// GridStack ì´ˆê¸°í™”
let grid = GridStack.init({
	cellHeight: 100, // ë†’ì´ ë‹¨ìœ„
	margin: 10,      // ê°„ê²©
	column: 12       // 12ë¶„í•  (ê³ ì •)
});

// ìœ„ì ¯ ì„¤ì • ì €ì¥ í•¨ìˆ˜ 
function saveLayout() {
	let widgetData = [];

	// í˜„ì¬ í™”ë©´ì˜ ìœ„ì ¯ ì •ë³´
	grid.engine.nodes.forEach(function(node) {
		widgetData.push({
			widgetNo: node.el.getAttribute('gs-id'),
			x: node.x,         // í˜„ì¬ x ì¢Œí‘œ
			y: node.y,         // í˜„ì¬ y ì¢Œí‘œ
			width: node.w,     // í˜„ì¬ ë„ˆë¹„
			height: node.h     // í˜„ì¬ ë†’ì´
		});
	});

	$.ajax({
		url: `${CONTEXT_PATH}/tudio/widget/saveLayout`,
		type: 'POST',
		contentType: 'application/json; charset=utf-8;',
		data: JSON.stringify(widgetData),
		success: function(res) {
			if(res === "OK") {
				console.log("ìœ„ì ¯ ë ˆì´ì•„ì›ƒ ì €ì¥ ì„±ê³µ");
			}
		},
		error: function(xhr, status, error) {
			console.error("ì €ì¥ ì‹¤íŒ¨:", error);
			alert("ìœ„ì ¯ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
		}
	});
}

/**
 * widget
 */
/* í”„ë¡œì íŠ¸ ìš”ì•½ */
function loadProjectSummary(widgetNo) {
    $.ajax({
        url: `${CONTEXT_PATH}/tudio/widget/projectSummary`,
        type: "GET",
        dataType: "json",
        success: function(taskList) {
            let $area = $("#project-summary-area-" + widgetNo);
            let html = '<ul class="list-group list-group-flush small">';

            if (taskList.length === 0) {
                html += '<li class="list-group-item text-center text-muted mt-3">ì˜ˆì •ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
            } else {
                $.each(taskList, function(i, task) {
                    // D-Day ë±ƒì§€ ìƒ‰ìƒ ì„¤ì •
                    let badgeClass = "bg-success";
                    let badgeText = "D-" + task.dDay;
                    
                    if (task.dDay < 0) {
                        badgeClass = "bg-danger";
                        badgeText = "ì§€ì—°";
                    } else if (task.dDay === 0) {
                        badgeClass = "bg-danger";
                        badgeText = "D-Day";
                    } else if (task.dDay <= 3) {
                        badgeClass = "bg-warning text-dark";
                    }

                    html += `
                        <li class="list-group-item px-0 py-2 border-bottom-0">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="text-truncate fw-bold" style="max-width: 60%;" title="\${task.taskTitle}">
                                    \${task.taskTitle}
                                </span>
                                <span class="badge \${badgeClass}">\${badgeText}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted text-truncate" style="max-width: 150px;">
                                    \${task.projectName}
                                </small>
                                <small class="text-info font-weight-bold">\${task.taskProgress}%</small>
                            </div>
                            <div class="progress mt-1" style="height: 4px;">
                                <div class="progress-bar bg-info" style="width: \${task.taskProgress}%"></div>
                            </div>
                        </li>
                    `;
                });
            }
            html += '</ul>';
            
            $area.html(html);
        },
        error: function() {
            $("#project-summary-area-" + widgetNo).html('<p class="text-center text-danger mt-3">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</p>');
        }
    });
}

/* [ìœ„ì ¯ 2] ê°œì¸ ì—…ë¬´ (ì£¼ê°„ ìŠ¤ì¼€ì¤„) */
function loadPersonalWork(widgetNo) {
    // ë‚ ì§œ í˜•ì‹ (YYYY-MM-DD)
    const today = new Date();
    const toYmd = (d) => {
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    };
    const sysToday = toYmd(today);

    $.ajax({
        url: `${CONTEXT_PATH}/tudio/widget/personalWork`,
        type: "GET",
        dataType: "json",
        success: function(workData) {
            // ì£¼ê°„ ìº˜ë¦°ë” ë Œë”ë§
            renderWeeklyCalendar(widgetNo, workData, today, toYmd);
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
            renderTaskList(widgetNo, workData, sysToday);
        },
        error: function() {
            $(`#pw-task-list-${widgetNo}`).html('<li class="list-group-item text-danger small">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</li>');
        }
    });
}

// ì£¼ê°„ ìº˜ë¦°ë”
function renderWeeklyCalendar(widgetNo, workData, today, toYmdFunc) {
    const $calBody = $(`#pw-calendar-body-${widgetNo}`);
    const currentDay = today.getDay(); // 0(ì¼) ~ 6(í† )
    
    // ì´ë²ˆ ì£¼ ì¼ìš”ì¼ ê³„ì‚°
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - currentDay);

    let html = '<tr>';
    for (let i = 0; i < 7; i++) {
        let tempDate = new Date(startOfWeek);
        tempDate.setDate(startOfWeek.getDate() + i);
        
        let ymd = toYmdFunc(tempDate);
        let dayNum = tempDate.getDate();
        
        // í•´ë‹¹ ë‚ ì§œì— ì—…ë¬´ê°€ ìˆëŠ”ì§€ í™•ì¸
        let hasWork = workData.some(task => task.WORK_DATE === ymd);
        let dotStyle = hasWork ? "display:block;" : "display:none;";

        html += `
            <td class="p-2 clickable-date position-relative" 
                data-date="${ymd}" 
                id="pw-cell-${widgetNo}-${ymd}" 
                style="cursor: pointer;">
                
                <div>${dayNum}</div>
                <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle" 
                      style="${dotStyle} width:8px; height:8px; transform: translate(-10px, 5px) !important;">
                </span>
            </td>
        `;
    }
    html += '</tr>';
    $calBody.html(html);

    // ë‚ ì§œ í´ë¦­ ì‹œ ì—…ë¬´ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    $calBody.find('.clickable-date').off('click').on('click', function() {
        let selectedDate = $(this).data('date');
        
        // UI í™œì„±í™”
        $calBody.find('.clickable-date').removeClass('table-active bg-light');
        $(this).addClass('table-active');

        renderTaskList(widgetNo, workData, selectedDate);
    });
    
    // (ì˜¤ëŠ˜) ë‚ ì§œ cell í™œì„±í™”
    $(`#pw-cell-${widgetNo}-${toYmdFunc(today)}`).addClass('table-active');
}

// ì„ íƒëœ ë‚ ì§œ ì—…ë¬´ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
function renderTaskList(widgetNo, workData, dateStr) {
    const $listArea = $(`#pw-task-list-${widgetNo}`);
    const $titleArea = $(`#pw-date-title-${widgetNo}`);
    
    const dateObj = new Date(dateStr);
    const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
    let titleText = `${dateStr} ${days[dateObj.getDay()]}`;
    
    // ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸
    const todayStr = new Date().toISOString().split('T')[0];
    if (dateStr === todayStr) {
        titleText += " <span class='badge bg-warning text-dark ms-1'>ì˜¤ëŠ˜</span>";
    }
    $titleArea.html(titleText);

    // ì—…ë¬´ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ ë° ì¶œë ¥
    const dailyTasks = workData.filter(task => task.WORK_DATE === dateStr);
    let html = '';

    if (dailyTasks.length === 0) {
        html = '<li class="list-group-item text-muted small border-0 ps-0">ë“±ë¡ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
    } else {
        dailyTasks.forEach(task => {
            let badgeClass = (task.WORK_TYPE === 'TASK') ? 'bg-primary' : 'bg-info';
            let typeName = (task.WORK_TYPE === 'TASK') ? 'ìƒìœ„' : 'í•˜ìœ„';

            html += `
                <li class="list-group-item border-0 ps-0 py-1 text-truncate">
                    <span class="badge ${badgeClass} me-2" style="font-size: 0.7rem;">${typeName}</span>
                    <span title="${task.WORK_TITLE}">${task.WORK_TITLE}</span>
                </li>
            `;
        });
    }
    $listArea.html(html);
}


/* [ìœ„ì ¯ 3] ì‹œìŠ¤í…œ ê³µì§€ì‚¬í•­ */
function loadNoticeList(widgetNo) {
    $.ajax({
        url: `${CONTEXT_PATH}/tudio/widget/noticeList`,
        type: "GET",
        dataType: "json",
        success: function(list) {
            let $area = $(`#notice-list-area-${widgetNo}`);
            let html = '<ul class="list-group list-group-flush">';

            if (list.length === 0) {
                html += '<li class="list-group-item text-center text-muted py-3 small">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
            } else {
                $.each(list, function(i, notice) {
                    // ë‚ ì§œ í˜•ì‹ í¬ë§· (YYYY-MM-DD)
                    let dateObj = new Date(notice.noticeRegdate);
                    let yyyy = dateObj.getFullYear();
                    let mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                    let dd = String(dateObj.getDate()).padStart(2, '0');
                    let dateStr = `${yyyy}-${mm}-${dd}`;

                    // ì œëª©, ë‚ ì§œ ì¶œë ¥ (ë±ƒì§€ X)
                    html += `
                        <li class="list-group-item px-0 py-2 d-flex justify-content-between align-items-center border-bottom-0">
                            <a href="${CONTEXT_PATH}/notice/detail?noticeNo=${notice.noticeNo}" 
                               class="text-dark text-decoration-none text-truncate" 
                               style="max-width: 75%; font-size: 0.9rem;">
                                ${notice.noticeTitle}
                            </a>
                            <small class="text-muted" style="font-size: 0.8rem;">${dateStr}</small>
                        </li>
                    `;
                });
            }
            html += '</ul>';
            $area.html(html);
        },
        error: function() {
            $(`#notice-list-area-${widgetNo}`).html('<p class="text-center text-danger small mt-3">ë¡œë”© ì‹¤íŒ¨</p>');
        }
    });
}

/* [ìœ„ì ¯ 4] ë¯¸í™•ì¸ ì•Œë¦¼ */
function loadAlarmList(widgetNo) {
    $.ajax({
        url: `${CONTEXT_PATH}/tudio/widget/alarmList`,
        type: "GET",
        dataType: "json",
        success: function(list) {
            let $area = $(`#alarm-list-area-${widgetNo}`);
            let html = '<ul class="list-group list-group-flush">';

            if (list.length === 0) {
                html += '<li class="list-group-item text-center text-muted py-3 small">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
            } else {
                $.each(list, function(i, noti) {
                    let dateObj = new Date(noti.noticeRegdate); 
                    
                    let mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                    let dd = String(dateObj.getDate()).padStart(2, '0');
                    let hh = String(dateObj.getHours()).padStart(2, '0');
                    let mi = String(dateObj.getMinutes()).padStart(2, '0');
                    let dateStr = `${mm}-${dd} ${hh}:${mi}`;

                    let contentHtml = '';
                    if(noti.notiUrl) {
                        contentHtml = `<a href="${CONTEXT_PATH}${noti.notiUrl}" class="text-dark text-decoration-none text-truncate" style="max-width: 75%; font-size: 0.9rem;">${noti.notiType}</a>`;
                    } else {
                        contentHtml = `<span class="text-dark text-truncate" style="max-width: 75%; font-size: 0.9rem;">${noti.notiType}</span>`;
                    }

                    html += `
                        <li class="list-group-item px-0 py-2 d-flex justify-content-between align-items-center border-bottom-0">
                            ${contentHtml}
                            <small class="text-muted" style="font-size: 0.8rem;">${dateStr}</small>
                        </li>
                    `;
                });
            }
            html += '</ul>';
            $area.html(html);
        },
        error: function() {
            $(`#alarm-list-area-${widgetNo}`).html('<p class="text-center text-danger small mt-3">ë¡œë”© ì‹¤íŒ¨</p>');
        }
    });
}

/* [ìœ„ì ¯ 5] í”„ë¡œì íŠ¸ ë¶ë§ˆí¬ */
function loadBookmarkList(widgetNo) {
    $.ajax({
        url: `${CONTEXT_PATH}/tudio/widget/bookmarkList`,
        type: "GET",
        dataType: "json",
        success: function(list) {
            let $area = $(`#bookmark-list-area-${widgetNo}`);
            let html = '<ul class="list-group list-group-flush">';

            if (list.length === 0) {
                html += '<li class="list-group-item text-center text-muted py-3 small">ë¶ë§ˆí¬í•œ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
            } else {
                $.each(list, function(i, project) {
                    // ìƒíƒœê°’ ë³„ ë±ƒì§€ (0: ì§„í–‰, 1: ì™„ë£Œ, 2: ì¤‘ë‹¨)
                    let statusBadge = '';
                    if(project.projectStatus === 0) statusBadge = '<span class="badge bg-primary">ì§„í–‰</span>';
                    else if(project.projectStatus === 1) statusBadge = '<span class="badge bg-success">ì™„ë£Œ</span>';
                    else if(project.projectStatus === 2) statusBadge = '<span class="badge bg-secondary">ì¤‘ë‹¨</span>';
                    
                    // í”„ë¡œì íŠ¸ ì§„ì²™ë„
                    let progress = project.projectProgress;
                    let progressColor = (progress >= 100) ? 'bg-success' : 'bg-info';

                    html += `
						<li class="list-group-item px-0 py-2 border-bottom-0 d-flex align-items-center justify-content-between">
					    	<div class="d-flex align-items-center" style="width: 25%; min-width: 0;">
					            <i class="bi bi-star-fill text-warning me-2 flex-shrink-0"></i>
					            <a href="${CONTEXT_PATH}/tudio/project/detail?projectNo=${project.projectNo}" 
					               class="text-dark text-decoration-none fw-bold text-truncate" title="${project.projectName}"> 
					               ${project.projectName}
					            </a>
					        </div>
							<div class="d-flex align-items-center flex-grow-1 mx-2">
					            <div class="progress w-100" style="height: 6px;">
					                <div class="progress-bar ${progressColor}" role="progressbar" 
					                     style="width: ${progress}%" aria-valuenow="${progress}" aria-valuemin="0" aria-valuemax="100">
					                </div>
					            </div>
					            <small class="ms-1 text-muted" style="font-size: 0.7rem; min-width: 25px; text-align: right; margin-right: 30px">${progress}%</small>
					        </div>
							<div class="flex-shrink-0">
					            ${statusBadge}
					        </div>
					    </li>
                    `;
                });
            }
            html += '</ul>';
            $area.html(html);
        },
        error: function() {
            $(`#bookmark-list-area-${widgetNo}`).html('<p class="text-center text-danger small mt-3">ë¡œë”© ì‹¤íŒ¨</p>');
        }
    });
}


/* [ìœ„ì ¯ 6] to do list */
function loadTodoList(widgetNo) {
    $.ajax({
		url: `${CONTEXT_PATH}/tudio/widget/todo`,
		type: "GET",
		dataType: "json",
        success: function(list) {
            let $area = $(`#todo-list-area-${widgetNo}`);
            let html = '<ul class="list-group list-group-flush">';

            if (list.length === 0) {
                html += '<li class="list-group-item text-center text-muted py-3 small">ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
            } else {
                $.each(list, function(i, todo) {
                    let isDone = (todo.todoStatus === 'Y');
                    let textStyle = isDone ? 'text-decoration-line-through text-muted' : '';
                    let checked = isDone ? 'checked' : '';

                    html += `
                        <li class="list-group-item px-0 py-2 border-bottom-0 d-flex justify-content-between align-items-center group-hover">
                            <div class="form-check text-truncate" style="max-width: 80%;">
                                <input class="form-check-input" type="checkbox" id="todoCheck${todo.todoNo}" 
                                       onchange="updateTodoStatus(${todo.todoNo}, '${widgetNo}', this.checked)" ${checked}>
                                <label class="form-check-label ${textStyle}" for="todoCheck${todo.todoNo}" 
                                       style="cursor:pointer; font-size: 0.9rem;">
                                    ${todo.todoContent}
                                </label>
                            </div>

                            <div class="btn-group btn-group-sm">
                                <button type="button" class="btn btn-link text-secondary p-0 me-2" 
                                        onclick="editTodoContent(${todo.todoNo}, '${widgetNo}', '${todo.todoContent}')">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                                <button type="button" class="btn btn-link text-danger p-0" 
                                        onclick="deleteTodo(${todo.todoNo}, '${widgetNo}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </li>
                    `;
                });
            }
            html += '</ul>';
            $area.html(html);
        },
		error: function() {
			$(`#todo-list-area-${widgetNo}`).html('<p class="text-center text-danger small mt-3">ë¡œë”© ì‹¤íŒ¨</p>');
	    }
    });
}

// [ìœ„ì ¯ 6-1] í•  ì¼ ì¶”ê°€
// 1. ì…ë ¥ ì¤„(Input Row) ìƒì„±
function showInputRow() {
    const container = document.getElementById('todoListContainer');

    // ì´ë¯¸ ì…ë ¥ ì¤‘ì¸ ì°½ì´ ìˆëŠ” ê²½ìš°, ì¤‘ë³µ ìƒì„± ë°©ì§€
    if (document.getElementById('newTodoInput')) {
        document.getElementById('newTodoInput').focus();
        return;
    }

	// li ìƒì„±
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between align-items-center bg-light'; // ì…ë ¥ ì¤‘ í‘œì‹œ
    li.id = 'inputRow';

    li.innerHTML = `
        <div class="d-flex align-items-center w-100">
            <span class="me-2" style="width: 20px;">ğŸ†•</span>
            
            <input type="text" id="newTodoInput" class="form-control" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ê³  ì—”í„°ë¥¼ ì¹˜ì„¸ìš”" 
                   onkeydown="handleEnter(event)">
        </div>
        
        <div class="ms-2 d-flex" style="min-width: 100px;">
            <button class="btn btn-sm btn-success me-1" onclick="saveNewTodo()">ì €ì¥</button>
            <button class="btn btn-sm btn-secondary" onclick="cancelInput()">ì·¨ì†Œ</button>
        </div>
    `;

    // container.prependChild(li); 	// ë¦¬ìŠ¤íŠ¸ì˜ ë§¨ ì•ì— ì¶”ê°€
    container.appendChild(li); 		// ë¦¬ìŠ¤íŠ¸ì˜ ë§¨ ëì— ì¶”ê°€
    
    // ì…ë ¥ì°½ í¬ì»¤ìŠ¤
    document.getElementById('newTodoInput').focus();
}

// 2. ìƒˆ í•  ì¼ ì €ì¥
function saveNewTodo() {
    const input = document.getElementById('newTodoInput');
    const content = input.value;

    if (!content.trim()) {
        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    fetch(`${CONTEXT_PATH}/tudio/todo/insert`, {
        method: 'POST',
        headers: { 
			'Content-Type': 'application/json' 
		},
        body: JSON.stringify({ content: content, completed: false })
    })
    .then(response => {
        if (response.ok) {
            loadTodoList(); // ì„±ê³µ ì‹œ íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ ì „ì²´ ë‹¤ì‹œ ë¡œë“œ
        } else {
            alert("ì €ì¥ ì‹¤íŒ¨");
        }
    });
}

// 3. í•  ì¼ ì¶”ê°€ ì·¨ì†Œ (ì…ë ¥ ì¤„ ì œê±°)
function cancelInput() {
    const inputRow = document.getElementById('inputRow');
    if (inputRow) {
        inputRow.remove(); // li ì‚­ì œ
    }
}

// ì—”í„°í‚¤ ì²˜ë¦¬
function handleEnter(e) {
    if (e.key === 'Enter') {
        saveNewTodo();
    } else if (e.key === 'Escape') {
        cancelInput();
    }
}


// [ìœ„ì ¯ 6-2] ìƒíƒœ ë³€ê²½ (ì²´í¬/í•´ì œ)
function toggleTodo(todoNo, checkbox) {
	let status = checkbox.checked ? 'Y' : 'N';
	let textSpan = $(checkbox).next('span');

	$.ajax({
		url: `${CONTEXT_PATH}/tudio/todo/updateStatus`,
		type: "POST",
		contentType: "application/json; charset=utf-8;",
		data: JSON.stringify({ todoNo: todoNo, todoStatus: status }),
		success: function(res) {
			if (res === "OK") {
				if (status === 'Y') {
					textSpan.addClass('text-decoration-line-through text-muted');
				} else {
					textSpan.removeClass('text-decoration-line-through text-muted');
				}
			}
		},
		error: function() {
			// ì‹¤íŒ¨ ì‹œ ì²´í¬ë°•ìŠ¤ ì›ìƒë³µêµ¬
			checkbox.checked = !checkbox.checked;
			Swal.fire('ì˜¤ë¥˜', 'ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨', 'error');
		}
	});
}

/* [ìœ„ì ¯ 6-3] íˆ¬ë‘ ì‚­ì œ */
function deleteTodo(todoNo, widgetNo) {
    if(!confirm("ì´ í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    let data = { todoNo: todoNo };

    $.ajax({
        url: `${CONTEXT_PATH}/tudio/todo/delete`,
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(data),
        success: function(res) {
            if(res === "OK") {
                loadTodoList(widgetNo); // ëª©ë¡ ê°±ì‹ 
            } else {
                alert("ì‚­ì œ ì‹¤íŒ¨");
            }
        },
        error: function() { alert("ì˜¤ë¥˜ ë°œìƒ"); }
    });
}

/* [ìœ„ì ¯ 6-4] íˆ¬ë‘ ë‚´ìš© ìˆ˜ì • */
function editTodoContent(todoNo, widgetNo, oldContent) {
    let newContent = prompt("ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:", oldContent);
    
    if(newContent === null) return; // ì·¨ì†Œ
    if(!newContent.trim()) {
        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    let data = {
        todoNo: todoNo,
        todoContent: newContent
    };

    $.ajax({
        url: `${CONTEXT_PATH}/tudio/widget/todo/modifyContent`,
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(data),
        success: function(res) {
            if(res === "OK") {
                loadTodoList(widgetNo);
            } else {
                alert("ìˆ˜ì • ì‹¤íŒ¨");
            }
        },
        error: function() { alert("ì˜¤ë¥˜ ë°œìƒ"); }
    });
}