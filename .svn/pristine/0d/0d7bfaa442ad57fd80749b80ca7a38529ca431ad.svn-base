<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.log.mapper.ILogMapper">

	<insert id="insertLoginLog" parameterType="kr.or.ddit.vo.log.LogLoginVO">
		INSERT INTO LOG_LOGIN (
			  LOGIN_LOG_ID
			, LOGIN_ID
			, LOGIN_STATUS
			, IP_ADDR
			, USER_AGENT
			, BROWSER
			, FAIL_REASON
			, MEMBER_NO
			, REG_DATE
		) VALUES (
			  SEQ_LOG_LOGIN.NEXTVAL
			, #{loginId}
			, #{loginStatus}
			, #{ipAddr}
			, #{userAgent}
			, #{browser}
			, #{failReason}
			, #{memberNo}
			, SYSDATE
		)
	</insert>

	<select id="selectLoginLogList" parameterType="kr.or.ddit.vo.log.LogSearchVO" resultType="kr.or.ddit.vo.log.LogLoginVO">
		SELECT * FROM (
			SELECT A.*, ROWNUM AS RNUM FROM (
				SELECT
					  LOGIN_LOG_ID
					, LOGIN_ID
					, LOGIN_STATUS
					, IP_ADDR
					, USER_AGENT
					, BROWSER
					, FAIL_REASON
					, MEMBER_NO
					, REG_DATE
				FROM LOG_LOGIN
				WHERE 1=1
				
				<if test="searchWord != null and searchWord != ''">
					AND (
						   LOGIN_ID LIKE '%' || #{searchWord} || '%'
						OR IP_ADDR  LIKE '%' || #{searchWord} || '%'
					)
				</if>
				<if test="status != null and status != 'all'">
	                AND LOGIN_STATUS = #{status}
	            </if>
	            
	            ORDER BY LOGIN_LOG_ID DESC
	            
			) A
        	WHERE ROWNUM <![CDATA[ <= ]]> #{endRow}
        )
    	WHERE RNUM <![CDATA[ >= ]]> #{startRow}
	</select>
	
	<select id="selectLoginLogCount" parameterType="kr.or.ddit.vo.log.LogSearchVO" resultType="int">
		SELECT COUNT(*)
		FROM LOG_LOGIN
		WHERE 1=1
		<if test="searchWord != null and searchWord != ''">
			AND (
				   LOGIN_ID LIKE '%' || #{searchWord} || '%'
				OR IP_ADDR  LIKE '%' || #{searchWord} || '%'
			)
		</if>
		<if test="status != null and status != 'all'">
            AND LOGIN_STATUS = #{status}
        </if>
	</select>
</mapper>