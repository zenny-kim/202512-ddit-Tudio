<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<link rel="stylesheet" href="${pageContext.request.contextPath}/css/tab_tasks.css">    

<div class="d-flex justify-content-between align-items-center mb-4 p-2 bg-light rounded">
    <h5 class="mb-0" id="taskViewTitle">업무 목록 (칸반)</h5>
    <div>
        <button class="btn btn-primary btn-sm me-2" data-bs-toggle="modal" data-bs-target="#newTaskModal"><i class="bi bi-plus me-1"></i> 새 업무 추가</button>
        <button class="btn btn-outline-secondary btn-sm" id="toggleViewButton"><i class="bi bi-list me-1"></i> 리스트 보기</button>
    </div>
</div>

<div id="kanbanView" class="kanban-board-layout d-flex pb-2" style="min-height: 500px;"> 
    <div class="kanban-column flex-shrink-0" style="width: 300px;">
        <h6 class="text-secondary fw-bold border-bottom pb-2 mb-3">TO DO (할 일) <span class="badge bg-secondary rounded-pill small">2</span></h6>
        <div class="kanban-items-list" id="todo-list" data-status="todo">
            <div class="card shadow-sm mb-3 task-card" role="button" data-bs-toggle="modal" data-bs-target="#taskDetailModal" data-task-id="TUDIO-001"> 
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <small class="text-muted">TUDIO-001</small>
                        <i class="bi bi-three-dots-vertical text-muted"></i>
                    </div>
                    <p class="fw-bold mb-2">프론트엔드 기본 구조 설계</p>
                    <div class="progress small mb-2" style="height: 5px;">
                        <div class="progress-bar bg-success" style="width: 60%;"></div>
                    </div>
                    <p class="small text-success fw-bold mb-1"><i class="bi bi-check-circle me-1"></i> 3/5 완료</p> 
                    <div class="d-flex justify-content-between align-items-center small mt-2">
                        <span class="badge bg-danger">Critical</span>
                        <div class="text-end"><small class="d-block text-muted">마감: 12/20</small><small>담당: K</small></div>
                    </div>
                </div>
            </div>
            </div>
    </div>
    </div>

<div id="listView" class="d-none">
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr><th>상태</th><th>업무명</th><th>진척도</th><th>담당자</th><th>마감일</th><th>우선순위</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge bg-secondary">할 일</span></td>
                    <td>TUDIO-001: 프론트엔드 기본 구조 설계</td>
                    <td><small>3/5 완료</small></td>
                    <td>김사용</td>
                    <td>2025-12-20</td>
                    <td><span class="badge bg-danger">Critical</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 칸반 드래그앤드롭
        const kanbanColumns = document.querySelectorAll('.kanban-items-list');
        kanbanColumns.forEach(column => {
            new Sortable(column, {
                group: 'kanban',
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag'
            });
        });

        // 뷰 전환
        const toggleBtn = document.getElementById('toggleViewButton');
        const kanbanDiv = document.getElementById('kanbanView');
        const listDiv = document.getElementById('listView');
        const title = document.getElementById('taskViewTitle');
        
        if (toggleBtn) {
            toggleBtn.addEventListener('click', function() {
                if (kanbanDiv.classList.contains('d-none')) {
                    listDiv.classList.add('d-none');
                    kanbanDiv.classList.remove('d-none');
                    title.textContent = '업무 목록 (칸반)';
                    this.innerHTML = '<i class="bi bi-list me-1"></i> 리스트 보기';
                } else {
                    kanbanDiv.classList.add('d-none');
                    listDiv.classList.remove('d-none');
                    title.textContent = '업무 목록 (리스트)';
                    this.innerHTML = '<i class="bi bi-grid-fill me-1"></i> 칸반 보기';
                }
            });
        }
    });
</script>