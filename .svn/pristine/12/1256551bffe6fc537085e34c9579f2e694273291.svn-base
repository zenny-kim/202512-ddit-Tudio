<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.siteAdmin.mapper.INoticeMapper">
	
	<select id="selectNoticeList" resultType="kr.or.ddit.vo.NoticeVO">
		SELECT * FROM (
			SELECT A.*, ROWNUM AS RNUM FROM (
				SELECT 
					N.NOTICE_NO AS noticeNo
					, N.NOTICE_TITLE AS noticeTitle
					, N.NOTICE_CONTENT AS noticeContent
					, N.NOTICE_REGDATE AS noticeRegdate
					, N.NOTICE_UPDDATE AS noticeUpdate
					, N.NOTICE_HIT AS noticeHit
					, N.NOTICE_FILE_NO AS noticeFileNo
					, N.NOTICE_PIN_STATUS AS noticePinStatus
					, N.MEMBER_NO AS memberNo
					, M.MEMBER_NAME AS writer
				FROM NOTICE N
				LEFT JOIN MEMBER M ON N.MEMBER_NO = M.MEMBER_NO
				ORDER BY N.NOTICE_PIN_STATUS DESC, N.NOTICE_NO DESC
			) A
			WHERE ROWNUM <![CDATA[ <= ]]> #{endRow}
		)
		WHERE RNUM <![CDATA[ >= ]]> #{startRow}
	</select>
	
	<insert id="insertNotice" parameterType="kr.or.ddit.vo.NoticeVO">
		INSERT INTO NOTICE(
			NOTICE_NO
			, NOTICE_TITLE
			, NOTICE_CONTENT
			, NOTICE_PIN_STATUS
			, MEMBER_NO
			, NOTICE_REGDATE
			, NOTICE_HIT
			, NOTICE_FILE_NO
		) VALUES (
			SEQ_NOTICE.NEXTVAL, #{noticeTitle}, #{noticeContent}, #{noticePinStatus},
			#{memberNo}, sysdate, 0, 0
		)
	</insert>
	
	<update id="updateNoticePin" parameterType="kr.or.ddit.vo.NoticeVO">
		UPDATE NOTICE
		SET NOTICE_PIN_STATUS = #{noticePinStatus}
		WHERE NOTICE_NO = #{noticeNo}
	</update>
	
	<select id="selectNoticeCount" parameterType="kr.or.ddit.vo.NoticeVO" resultType="int">
		SELECT COUNT(*)
		FROM NOTICE
	</select>
	
	<select id="selectNoticeDetail" parameterType="int" resultType="kr.or.ddit.vo.NoticeVO">
		SELECT 
			N.NOTICE_NO AS noticeNo
			, N.NOTICE_TITLE AS noticeTitle
			, N.NOTICE_CONTENT AS noticeContent
			, N.NOTICE_REGDATE AS noticeRegdate
			, N.NOTICE_UPDDATE AS noticeUpdate
			, N.NOTICE_HIT AS noticeHit
			, N.NOTICE_FILE_NO AS noticeFileNo
			, N.NOTICE_PIN_STATUS AS noticePinStatus
			, N.MEMBER_NO AS memberNo
			, M.MEMBER_NAME AS writer
		FROM NOTICE N
		LEFT JOIN MEMBER M ON N.MEMBER_NO = M.MEMBER_NO
		WHERE N.NOTICE_NO = #{noticeNo}
	</select>
	
	<update id="updateNotice" parameterType="kr.or.ddit.vo.NoticeVO">
		UPDATE NOTICE
		SET 
			NOTICE_TITLE = #{noticeTitle}
			, NOTICE_CONTENT = #{noticeContent}
			, NOTICE_PIN_STATUS = #{noticePinStatus}
			, NOTICE_UPDDATE = sysdate
		WHERE NOTICE_NO = #{noticeNo}
	</update>

	<delete id="deleteNotice" parameterType="int">
		DELETE FROM NOTICE 
		WHERE NOTICE_NO = #{noticeNo}
	</delete>

	<update id="incrementHit" parameterType="int">
		UPDATE NOTICE 
		SET NOTICE_HIT = NOTICE_HIT + 1
		WHERE NOTICE_NO = #{noticeNo}
	</update>

	<select id="selectMemberAuthList" parameterType="int" resultType="kr.or.ddit.vo.MemberAuthVO">
		SELECT 
			MEMBER_NO AS memberNo
			, AUTH AS auth
		FROM MEMBER_AUTH
		WHERE MEMBER_NO = #{memberNo}
	</select>
</mapper>