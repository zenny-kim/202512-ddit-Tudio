package kr.or.ddit.dashboard.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.SessionAttribute;

import kr.or.ddit.ServiceResult;
import kr.or.ddit.dashboard.service.ITodoService;
import kr.or.ddit.vo.MemberVO;
import kr.or.ddit.vo.TodoVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/tudio/todo")
public class TodoController {
	
	@Autowired 
	private ITodoService todoService;
	
	/**
	 * todo list 조회
	 * @param todoVO
	 * @param loginMember
	 * @return
	 */
	@GetMapping("/list")
	@ResponseBody
	public ResponseEntity<List<TodoVO>> listTodo(TodoVO todoVO, @SessionAttribute("loginUser") MemberVO loginMember) {
		log.info("listTodo() 실행...!");
		
		try {
			List<TodoVO> todoList = todoService.selectTodoList(loginMember.getMemberNo());
			return new ResponseEntity<>(todoList, HttpStatus.OK);
		} catch (Exception e) {
			return new ResponseEntity<>(HttpStatus.INTERNAL_SERVER_ERROR);
		}
	}
	
	/**
     * [1] 할 일 등록
     */
    @PostMapping("/insert")
    @ResponseBody
    public ResponseEntity<ServiceResult> insertTodo(@RequestBody TodoVO todoVO, @SessionAttribute("loginUser") MemberVO loginMember) {
        log.info("insertTodo() 실행...!");
        todoVO.setMemberNo(loginMember.getMemberNo());
        
        try {
            int cnt = todoService.insertTodo(todoVO);
            if (cnt > 0) {
                return new ResponseEntity<>(ServiceResult.OK, HttpStatus.OK);
            } else {
                return new ResponseEntity<>(ServiceResult.FAILED, HttpStatus.BAD_REQUEST);
            }
        } catch (Exception e) {
            log.error("할 일 등록 중 오류: ", e);
            return new ResponseEntity<>(ServiceResult.ERROR, HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }

    /**
     * [2] 할 일 완료/취소 상태 변경
     */
    @PostMapping("/updateStatus")
    @ResponseBody
    public ResponseEntity<ServiceResult> updateTodoStatus(@RequestBody TodoVO todoVO, @SessionAttribute("loginUser") MemberVO loginMember) {
        log.info("updateTodoStatus() 실행...!");
        todoVO.setMemberNo(loginMember.getMemberNo());

        try {
            int cnt = todoService.updateTodoStatus(todoVO);
            if (cnt > 0) {
                return new ResponseEntity<>(ServiceResult.OK, HttpStatus.OK);
            } else {
                return new ResponseEntity<>(ServiceResult.FAILED, HttpStatus.BAD_REQUEST);
            }
        } catch (Exception e) {
            log.error("할 일 상태 변경 중 오류: ", e);
            return new ResponseEntity<>(ServiceResult.ERROR, HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }

    /**
     * [3] 할 일 내용 수정
     */
    @PostMapping("/updateContent")
    @ResponseBody
    public ResponseEntity<ServiceResult> updateTodoContent(@RequestBody TodoVO todoVO, @SessionAttribute("loginUser") MemberVO loginMember) {
        log.info("modifyTodoContent() 실행...!");
        todoVO.setMemberNo(loginMember.getMemberNo());

        try {
            int cnt = todoService.updateTodoContent(todoVO);
            if (cnt > 0) {
                return new ResponseEntity<>(ServiceResult.OK, HttpStatus.OK);
            } else {
                return new ResponseEntity<>(ServiceResult.FAILED, HttpStatus.BAD_REQUEST);
            }
        } catch (Exception e) {
            log.error("할 일 내용 수정 중 오류: ", e);
            return new ResponseEntity<>(ServiceResult.ERROR, HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }

    /**
     * [4] 할 일 삭제
     */
    @PostMapping("/delete")
    @ResponseBody
    public ResponseEntity<ServiceResult> deleteTodo(@RequestBody TodoVO todoVO, @SessionAttribute("loginUser") MemberVO loginMember) {
        log.info("deleteTodo() 실행...!");
        todoVO.setMemberNo(loginMember.getMemberNo());

        try {
            int cnt = todoService.deleteTodo(todoVO);
            if (cnt > 0) {
                return new ResponseEntity<>(ServiceResult.OK, HttpStatus.OK);
            } else {
                return new ResponseEntity<>(ServiceResult.FAILED, HttpStatus.BAD_REQUEST);
            }
        } catch (Exception e) {
            log.error("할 일 삭제 중 오류: ", e);
            return new ResponseEntity<>(ServiceResult.ERROR, HttpStatus.INTERNAL_SERVER_ERROR);
        }
    }
	
}
