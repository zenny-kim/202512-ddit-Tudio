<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%-- 
    파일명: project_list.jsp
    설명: 프로젝트 목록 조회 및 검색/필터링 페이지
--%>

<div class="main-content-wrap flex-grow-1">
    <div class="container-fluid">
        
        <h1 class="h3 mb-4 text-gray-800">프로젝트 목록</h1>
        
        <div class="card shadow-sm mb-4 p-3 bg-light border">
            <div class="row g-3 align-items-center">
                
                <div class="col-auto">
                    <label for="filterSelect" class="col-form-label small text-muted me-2">검색:</label>
                </div>
                <div class="col-md-2">
                    <select id="filterSelect" class="form-select">
                        <option value="name" selected>프로젝트명</option>
                        <option value="duration">프로젝트 기간</option>
                    </select>
                </div>
                
                <div class="col" id="searchInputsContainer"> 
                    <div id="inputName" class="filter-input-group">
                        <input type="text" class="form-control" placeholder="검색어를 입력하세요...">
                    </div>

                    <div id="inputDuration" class="filter-input-group d-none">
                        <div class="input-group">
                            <input type="date" class="form-control" id="startDate" aria-label="시작일">
                            <span class="input-group-text">~</span>
                            <input type="date" class="form-control" id="endDate" aria-label="종료일">
                        </div>
                    </div>
                </div>
                
                <div class="col-auto">
                    <button class="btn btn-primary" id="searchButton"><i class="bi bi-search"></i> 검색</button>
                </div>

                <div class="col-auto d-none d-lg-block border-start mx-2" style="height: 24px;"></div>

                <div class="col-auto ms-auto-lg"> 
                    <div class="d-flex align-items-center">
                        <label for="sortSelect" class="col-form-label small text-muted me-2 text-nowrap"><i class="bi bi-sort-down"></i> 정렬:</label>
                        <select id="sortSelect" class="form-select sort-select">
                            <option value="latest" selected>최신 등록순</option>
                            <option value="deadline">마감 임박순</option>
                            <option value="name">프로젝트명순</option>
                        </select>
                    </div>
                </div>

            </div>
        </div>

        <div class="row g-4" id="projectListContainer">
            
            <div class="col-12">
                <div class="card shadow-lg project-card" onclick="window.location.href='project_detail.jsp'">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div class="project-info d-flex align-items-center"> 
                            <i class="bi bi-star-fill text-warning fs-4 favorite-icon me-3" data-favorited="true" role="button" title="즐겨찾기 해제" onclick="event.stopPropagation();"></i>
                            
                            <div>
                                <span class="badge bg-success me-2">진행 중</span>
                                <h5 class="card-title mb-0 d-inline-block">Tudio 런칭 프로젝트 (Tudio Launch)</h5>
                                <p class="card-text text-muted mt-1 small">기간: 2025.01.01 ~ 2025.12.31 (D-15)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="card shadow-lg project-card" onclick="window.location.href='project_detail.jsp'">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div class="project-info d-flex align-items-center">
                            <i class="bi bi-star fs-4 favorite-icon me-3" data-favorited="false" role="button" title="즐겨찾기 추가" onclick="event.stopPropagation();"></i>
                            
                            <div>
                                <span class="badge bg-secondary me-2">완료</span>
                                <h5 class="card-title mb-0 d-inline-block">2024년 고객사 A 웹사이트 구축</h5>
                                <p class="card-text text-muted mt-1 small">기간: 2024.03.15 ~ 2024.11.30 (완료됨)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-12">
                <div class="card shadow-lg project-card" onclick="window.location.href='project_detail.jsp'">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div class="project-info d-flex align-items-center">
                            <i class="bi bi-star-fill text-warning fs-4 favorite-icon me-3" data-favorited="true" role="button" title="즐겨찾기 해제" onclick="event.stopPropagation();"></i>
                            
                            <div>
                                <span class="badge bg-danger me-2">지연</span>
                                <h5 class="card-title mb-0 d-inline-block">클라이언트 B 신규 서비스 개발</h5>
                                <p class="card-text text-muted mt-1 small">기간: 2025.06.01 ~ 2025.11.30 (마감일 초과)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 필터 선택 드롭다운 요소
        const filterSelect = document.getElementById('filterSelect');
        // 동적 입력 필드 그룹
        const inputName = document.getElementById('inputName');
        const inputDuration = document.getElementById('inputDuration');

        // --- 1. 필터 변경 이벤트 핸들러 (검색 조건 변경) ---
        filterSelect.addEventListener('change', function() {
            const selectedValue = this.value;

            if (selectedValue === 'name') {
                // 프로젝트명 선택 시: 기간 필드 숨기고 이름 필드 표시
                inputDuration.classList.add('d-none');
                inputName.classList.remove('d-none');
            } else if (selectedValue === 'duration') {
                // 기간 선택 시: 이름 필드 숨기고 기간 필드 표시
                inputName.classList.add('d-none');
                inputDuration.classList.remove('d-none');
            }
        });

        // --- 2. 정렬 변경 이벤트 핸들러 ---
        const sortSelect = document.getElementById('sortSelect');
        sortSelect.addEventListener('change', function() {
            console.log('정렬 기준 변경됨:', this.value);
            // [Todo] 실제 구현 시 AJAX 요청 또는 리스트 재정렬 로직 추가
        });

        // --- 3. 즐겨찾기 아이콘 토글 로직 ---
        const favoriteIcons = document.querySelectorAll('.favorite-icon');

        favoriteIcons.forEach(icon => {
            icon.addEventListener('click', function(event) {
                // 부모 요소(카드)의 클릭 이벤트 전파 방지
                event.stopPropagation(); 
                event.preventDefault();

                let isFavorited = this.getAttribute('data-favorited') === 'true';

                if (isFavorited) {
                    // 즐겨찾기 해제
                    this.classList.remove('bi-star-fill', 'text-warning');
                    this.classList.add('bi-star', 'text-muted');
                    this.setAttribute('data-favorited', 'false');
                    this.setAttribute('title', '즐겨찾기 추가');
                } else {
                    // 즐겨찾기 추가
                    this.classList.remove('bi-star', 'text-muted');
                    this.classList.add('bi-star-fill', 'text-warning');
                    this.setAttribute('data-favorited', 'true');
                    this.setAttribute('title', '즐겨찾기 해제'); 
                }
                
                // [Todo] 서버에 즐겨찾기 상태 변경 요청 (AJAX)
            });
        });
        
        // --- 4. 프로젝트 카드 클릭 시 상세 페이지 이동 ---
        document.querySelectorAll('.project-card').forEach(card => {
            card.addEventListener('click', function() {
                // onclick 속성에서 URL 추출 또는 data-url 속성 사용 권장
                const targetUrl = this.getAttribute('onclick').replace("window.location.href='", "").replace("'", "");
                window.location.href = targetUrl;
            });
        });
    });
</script>