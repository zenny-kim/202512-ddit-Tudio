<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="jakarta.tags.core" prefix="c" %>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
    <!-- GridStack.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/7.2.3/gridstack.min.css" rel="stylesheet" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/7.2.3/gridstack-all.js"></script>
    
	<!-- layout css -->    
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/header.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/sidebar.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/footer.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/dashboard.css">
</head>
<body data-context-path="${pageContext.request.contextPath}">
	<jsp:include page="./include/header_user.jsp"/>
    
    <jsp:include page="./include/sidebar_user.jsp">
    	<jsp:param name="menu" value="dashboard" />
    </jsp:include>

	<main class="main-content-wrap">
		<div class="container-fluid">
			<h3>
				메인 대시보드
				<button onclick="saveLayout()" class="btn btn-primary btn-sm">저장</button>
			</h3>

			<div class="grid-stack">
				<c:forEach items="${widgetList}" var="widget">
					<div class="grid-stack-item" gs-id="${widget.widgetNo}"
						gs-x="${widget.x}" gs-y="${widget.y}" gs-w="${widget.width}"
						gs-h="${widget.height}">

						<div class="grid-stack-item-content">
							<%-- <h5>${widget.widgetType}</h5> --%>

							<c:choose>

								<c:when test="${widget.widgetType eq 'PROJECT_SUMMARY'}">
									<div class="h-100 d-flex flex-column">
										<h6 class="font-weight-bold text-gray-800 mb-3">
											<i class="bi bi-stopwatch text-danger"></i> 마감 임박 업무
										</h6>

										<div id="project-summary-area-${widget.widgetNo}"
											class="flex-grow-1 overflow-auto">
											<div class="text-center mt-4">
												<div class="spinner-border text-primary" role="status">
													<span class="visually-hidden">Loading...</span>
												</div>
											</div>
										</div>
									</div>

									<script>
										$(document).ready(function() {
									    	loadProjectSummary('${widget.widgetNo}');
									    });
									</script>
								</c:when>

								<c:when test="${widget.widgetType eq 'PERSONAL_WORK'}">
									<div class="h-100 d-flex flex-column">
										<h6 class="font-weight-bold text-gray-800 mb-3">
											<i class="bi bi-calendar-week text-primary"></i> 개인 업무
										</h6>

										<div class="flex-grow-1 d-flex flex-column justify-content-between">

											<div class="mb-2">
												<div id="pw-date-title-${widget.widgetNo}" class="fw-bold small mb-2 text-primary">
													<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 
													Loading...
												</div>

												<ul id="pw-task-list-${widget.widgetNo}" class="list-group list-group-flush small overflow-auto" style="max-height: 130px;">
													<div class="text-center py-3">
														<div class="spinner-border spinner-border-sm text-primary" role="status">
															<span class="visually-hidden">Loading...</span>
														</div>
													</div>
												</ul>
											</div>

											<div>
												<div class="d-flex align-items-end mb-1">
													<small class="text-muted" style="font-size: 0.75rem;">주간 스케줄</small>
												</div>
												<table class="table table-bordered text-center mb-0" style="table-layout: fixed; font-size: 0.8rem;">
													<thead class="bg-light">
														<tr>
															<th class="text-danger p-1">일</th>
															<th class="p-1">월</th>
															<th class="p-1">화</th>
															<th class="p-1">수</th>
															<th class="p-1">목</th>
															<th class="p-1">금</th>
															<th class="text-primary p-1">토</th>
														</tr>
													</thead>
													<tbody id="pw-calendar-body-${widget.widgetNo}">
														<tr>
															<td colspan="7" class="p-2">
																<span class="spinner-border spinner-border-sm text-secondary" role="status"></span>
															</td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>

									<script>
								        $(document).ready(function() {
								            loadPersonalWork('${widget.widgetNo}');
								        });
								    </script>
								</c:when>

								<c:when test="${widget.widgetType eq 'NOTICE'}">
									<div class="h-100 d-flex flex-column">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h6 class="font-weight-bold text-gray-800 mb-0">
												<i class="bi bi-megaphone-fill text-warning me-1"></i> 시스템 공지사항
											</h6>
											<a href="${pageContext.request.contextPath}/notice/list" class="text-muted small text-decoration-none"> 
												<i class="bi bi-plus-lg"></i>
											</a>
										</div>

										<div id="notice-list-area-${widget.widgetNo}" class="flex-grow-1 overflow-auto">
											<div class="text-center mt-4">
												<div class="spinner-border spinner-border-sm text-warning" role="status">
													<span class="visually-hidden">Loading...</span>
												</div>
											</div>
										</div>
									</div>

									<script>
								        $(document).ready(function() {
								            loadNoticeList('${widget.widgetNo}');
								        });
								    </script>
								</c:when>

								<c:when test="${widget.widgetType eq 'ALARM'}">
									<div class="h-100 d-flex flex-column">
										<h6 class="font-weight-bold text-gray-800 mb-3">
											<i class="bi bi-bell-fill text-danger me-1"></i> 미확인 알림
										</h6>

										<div id="alarm-list-area-${widget.widgetNo}" class="flex-grow-1 overflow-auto">
											<div class="text-center mt-4">
												<div class="spinner-border spinner-border-sm text-danger" role="status">
													<span class="visually-hidden">Loading...</span>
												</div>
											</div>
										</div>
									</div>

									<script>
								        $(document).ready(function() {
								            loadAlarmList('${widget.widgetNo}');
								        });
								    </script>
								</c:when>

								<c:when test="${widget.widgetType eq 'PROJECT_BOOKMARK'}">
									<div class="h-100 d-flex flex-column">
										<h6 class="font-weight-bold text-gray-800 mb-3">
											<i class="bi bi-bookmarks-fill text-info me-1"></i> 북마크 프로젝트
										</h6>

										<div id="bookmark-list-area-${widget.widgetNo}" class="flex-grow-1 overflow-auto">
											<div class="text-center mt-4">
												<div class="spinner-border spinner-border-sm text-info" role="status">
													<span class="visually-hidden">Loading...</span>
												</div>
											</div>
										</div>
									</div>

									<script>
								        $(document).ready(function() {
								            loadBookmarkList('${widget.widgetNo}');
								        });
								    </script>
								</c:when>

								<c:when test="${widget.widgetType eq 'TODO'}">
									<div class="h-100 d-flex flex-column">
										<div class="d-flex justify-content-between align-items-center mb-3">
											<h6 class="font-weight-bold text-gray-800 mb-0">
												<i class="bi bi-check2-square text-primary me-1"></i> To Do List
											</h6>
											<button class="btn btn-primary" onclick="showInputRow()"><i class="bi bi-plus-lg"></i> 할일 추가</button>
										</div>
										<ul id="todoListContainer" class="list-group"></ul>

										<div id="todo-list-area-${widget.widgetNo}"
											class="flex-grow-1 overflow-auto">
											<div class="text-center mt-4">
												<div class="spinner-border spinner-border-sm text-primary" role="status">
													<span class="visually-hidden">Loading...</span>
												</div>
											</div>
										</div>
									</div>

									<script>
								        $(document).ready(function() {
								            loadTodoList('${widget.widgetNo}');
								        });
								    </script>
								</c:when>

								<c:otherwise>
									<div class="d-flex align-items-center justify-content-center h-100 text-muted">
										준비 중 (${widget.widgetType})
									</div>
								</c:otherwise>

							</c:choose>

						</div>
					</div>
				</c:forEach>
			</div>
		</div>
	</main>

	<jsp:include page="./include/footer.jsp"/>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="${pageContext.request.contextPath}/js/footer.js"></script>
    <script src="${pageContext.request.contextPath}/js/dashboard.js"></script>
</body>
</html>