package kr.or.ddit.faq.controller;

import java.time.LocalDateTime;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import jakarta.servlet.http.HttpSession;
import kr.or.ddit.ServiceResult;
import kr.or.ddit.faq.service.IFaqService;
import kr.or.ddit.vo.FaqVO;
import kr.or.ddit.vo.MemberVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@RestController
@CrossOrigin(origins = "http://localhost:5173")
@RequestMapping("/api/faq")
public class FaqApiController {

	@Autowired
	private IFaqService faqService;
	
	// 반복되는 리터럴 문자열을 final 변수로 만듦
	private static final String LOGIN_USER = "loginUser";
	
	@GetMapping("/list")
	public List<FaqVO> faqList() {
		return faqService.selectFaqList();
	}
	
	@PostMapping("/write")
	public ServiceResult faqWrite(@RequestBody FaqVO faqVo, HttpSession session) {
		MemberVO loginUser = (MemberVO) session.getAttribute(LOGIN_USER);
		LocalDateTime now = LocalDateTime.now();

		faqVo.setAdminNo(loginUser.getMemberNo());
		faqVo.setFaqRegdate(now);
		faqVo.setFaqUpdate(now);
		
		log.info("[myLog] : " + faqVo.toString());
		
		return faqService.insertFaq(faqVo);
	}
	
	@PostMapping("/edit")
	public ServiceResult faqEdit(@RequestBody FaqVO faqVo, HttpSession session) {
		MemberVO loginUser = (MemberVO) session.getAttribute(LOGIN_USER);
		LocalDateTime now = LocalDateTime.now();

		faqVo.setAdminNo(loginUser.getMemberNo());
		faqVo.setFaqUpdate(now);
		
		return faqService.updateFaq(faqVo);
	}
}
