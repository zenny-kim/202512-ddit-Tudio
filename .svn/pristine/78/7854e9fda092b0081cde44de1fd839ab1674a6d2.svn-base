package kr.or.ddit.projectTask.controller;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.dto.GanttTaskDTO;
import kr.or.ddit.projectTask.service.IProjectGanttService;
import lombok.extern.slf4j.Slf4j;

/**
 * <pre>
 * PROJ : Tudio
 * Name : ProjectGanttController
 * DESC : ê°„íŠ¸ì°¨íŠ¸ í´ë˜ìŠ¤
 * </pre>
 * 
 * @author [ëŒ€ë•ì¸ì¬ê°œë°œì›] team1 KHJ
 * @version 1.0, 2026.01.07
 * 
 */

@Slf4j
@Controller
@RequestMapping("/tudio/project")
public class ProjectGanttController {
	
	@Autowired
    private IProjectGanttService ganttService;
	
	/**
	 *  ê°„íŠ¸ì°¨íŠ¸ í™”ë©´ ì§„ì… 
	 */
	@GetMapping("/gantt/view")
	public String ganttPage(@RequestParam(value="projectNo", required=false, defaultValue="0") int projectNo, Model model) {
		
		model.addAttribute("projectNo", projectNo);
		return "gantt/gantt";
	}
	
	
	/**
	 * ê°„íŠ¸ ì°¨íŠ¸ì— ë¿Œë¦´ ë°ì´í„° ë¦¬í„´(JSON)
	 */
	@GetMapping("/gantt/data")
    @ResponseBody
    public Map<String, Object> getGanttData(@RequestParam(value = "projectNo", required = false) int projectNo) {
		log.warn("ğŸ”¥ ganttData í˜¸ì¶œë¨ / projectNo = [{}]", projectNo);
        Map<String, Object> result = new HashMap<>();
        
        // 1. ë²ˆí˜¸ê°€ 0ì´ê±°ë‚˜ ìŒìˆ˜ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‹´ì•„ì„œ ë°”ë¡œ ë¦¬í„´!
        if (projectNo <= 0) {
            result.put("data", new ArrayList<GanttTaskDTO>()); // ë¹ˆ ë°”êµ¬ë‹ˆ ìƒì„±
            return result; 
        }
        result.put("data", ganttService.getGanttTaskList(projectNo));
        return result;
    }
	
}
