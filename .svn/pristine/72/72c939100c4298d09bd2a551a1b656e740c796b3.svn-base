package kr.or.ddit.projectMember.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.projectMember.service.IProjectMemberService;
import kr.or.ddit.vo.project.ProjectMemberVO;
import lombok.extern.slf4j.Slf4j;

/**
 * <pre>
 * PROJ : Tudio
 * Name : projectBoard
 * DESC : 프로젝트 구성원
 * </pre>
 * 
 * @author [대덕인재개발원] team1 KMS
 * @version 1.0, 2025.12.30
 * 
 */
@Slf4j
@Controller
@RequestMapping("/tudio/project/member")
public class ProjectMemberController {

	@Autowired
	private IProjectMemberService service;

	/**
	 * 프로젝트 구성원 jsp 탭 조각 반환 (HTML fragment)
	 * 
	 * @param projectNo
	 * @param model
	 * @return
	 */
	@GetMapping("/view")
	public String projectTabMemberList(@RequestParam int projectNo, Model model) {

		List<ProjectMemberVO> list = service.list(projectNo);
		int count = service.tabMemberCount(projectNo);
		model.addAttribute("list", list);
		model.addAttribute("count", count);
		model.addAttribute("projectNo", projectNo);

		return "project/tabs/tab_member";
	}

	/**
	 * 모달 JSON 반환
	 * 
	 * @param projectNo
	 * @param memberNo
	 * @return
	 */
	@GetMapping("/memberModal")
	@ResponseBody 
	public ProjectMemberVO projectTabMemberModal(@RequestParam int projectNo, @RequestParam int memberNo) {

		ProjectMemberVO vo = new ProjectMemberVO();
		vo.setMemberNo(memberNo);
		vo.setProjectNo(projectNo); // VO에 값 주입
		// 파라미터가 projectNo를 포함해서 2개가 필요하고, ProjectVOTabMemberVO에 projectNo가 있는 경우
		// projectNo를 ProjectTabMemberVO에 넣고 파라미터를 1개로 처리하기

		return service.modalList(vo);
	}

	
	
	 /**
	  * 차트 데이터 반환  
	  * @param projectNo
	  * @return
	  */
	  @GetMapping("/memberChart")	  
	  @ResponseBody 
	  public List<ProjectMemberVO> projectTabMemberChart(@RequestParam int projectNo) {
		
		  return service.chartList(projectNo);
	  
	  }
	 
	 

}
