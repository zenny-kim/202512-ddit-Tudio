package kr.or.ddit.meetingRoom.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import jakarta.servlet.http.HttpSession;
import kr.or.ddit.file.service.IFileService;
import kr.or.ddit.meetingRoom.service.IMeetingRoomService;
import kr.or.ddit.vo.FileDetailVO;
import kr.or.ddit.vo.MemberVO;
import kr.or.ddit.vo.meetingRoom.MeetingBranchVO;
import kr.or.ddit.vo.meetingRoom.MeetingRoomVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("tudio/project/meetingRoom")
public class MeetingRoomController {

	@Autowired
	private IMeetingRoomService meetingRoomService;
	@Autowired
	private IFileService fileService;
	
	// 회의실 화면 생성
	@GetMapping
	public String MeetingRoomPage( HttpSession session, Model model)	{
		log.info("MeetingRoomPage() 실행");
		MemberVO loginUser = (MemberVO) session.getAttribute("loginUser");
	    if(loginUser == null) {
	        return "redirect:/tudio/login";
	    }
	    List<MeetingBranchVO> branchList = meetingRoomService.selectBranchList();
        model.addAttribute("branchList", branchList);
		return "project/tabs/meetingRoom/meetingRoom";
	}
	
	// 회의실 목록 조회
	@GetMapping("/list")
    public ResponseEntity<List<MeetingRoomVO>> getRooms(@RequestParam("branchId") int branchId) {
        log.info("getRooms : branchId={}", branchId);
        List<MeetingRoomVO> list = meetingRoomService.selectMeetingRoomList(branchId);
        return new ResponseEntity<>(list, HttpStatus.OK);
    }
	
	// 회의실 사진, 주소 조회
	@GetMapping("/fileList")
	@ResponseBody
	public ResponseEntity<List<FileDetailVO>> getFileList(@RequestParam("fileGroupNo") int fileGroupNo) {
		log.info("getFileList : fileGroupNo={}", fileGroupNo);
		// 서비스에 이미 구현된 selectFileDetailList 메서드 활용
		List<FileDetailVO> fileList = fileService.selectFileDetailList(fileGroupNo);
		return new ResponseEntity<>(fileList, HttpStatus.OK);
	}
	
}
