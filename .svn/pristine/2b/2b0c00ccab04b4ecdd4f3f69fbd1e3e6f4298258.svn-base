<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.core" prefix="c"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tudio</title>
<jsp:include page="/WEB-INF/views/include/common.jsp" />
<link rel="stylesheet"
	href="${pageContext.request.contextPath}/css/project_common.css">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<script
	src="https://cdn.ckeditor.com/ckeditor5/34.0.0/classic/ckeditor.js"></script>
<style>
.ck-editor__editable {
	min-height: 400px !important;
	border: 1px solid #ccced1 !important;
} /* 에디터 높이 확보 */
.bg-light {
	background-color: #f8fafc !important;
}
/* 테이블 마우스 오버 시 발생하는 배경색 변화와 글자 흔들림 방지 */
.table.table-hover-custom, .table.table-hover-custom tr, .table.table-hover-custom td
	{
	--bs-table-hover-bg: transparent !important; /* 배경색 변화 제거 */
	--bs-table-accent-bg: transparent !important;
	transition: none !important; /* 움직임 효과 제거 */
	transform: none !important; /* 위치 이동 제거 */
}
/* 1. 테이블 전체 스타일 수정 */
.custom-table {
	border-collapse: collapse !important;
	border-left: none !important; /* 왼쪽 외곽선 제거 */
	border-right: none !important; /* 오른쪽 외곽선 제거 */
	border-top: 1px solid #dee2e6 !important; /* 상단 실선 */
	border-bottom: 1px solid #dee2e6 !important; /* 하단 실선 */
}

/* 2. 내부 셀 테두리 설정 */
.custom-table th, .custom-table td {
	border: 1px solid #dee2e6 !important; /* 내부를 한줄 실선으로 */
	border-left: none !important; /* 셀의 왼쪽 선 제거 (중복 방지 및 외곽선 제거) */
	border-right: none !important; /* 셀의 오른쪽 선 제거 */
}

/* 3. 첫 번째 칸(헤더)과 마지막 칸의 간격 조절 */
.custom-table th:first-child, .custom-table td:first-child {
	border-left: none !important;
	padding-left: 15px;
}

.custom-table th:last-child, .custom-table td:last-child {
	border-right: none !important;
	padding-right: 15px;
}

/* 4. 제목(th) 배경색 및 글자색 살짝 조정 */
.custom-table th.bg-light {
	background-color: #fcfcfc !important; /* 너무 칙칙하지 않은 밝은 회색 */
	font-weight: 600;
	color: #444;
}
</style>
</head>
<body>
	<section class="tudio-section">
		<!-- APPROVAL FORM 화면 입니다. -->
		<jsp:include page="../include/headerUser.jsp" />

		<div class="d-flex">
			<!-- 사이드바 -->
			<jsp:include page="../include/sidebarUser.jsp">
				<jsp:param name="menu" value="approval" />
			</jsp:include>

			<main class="main-content-wrap flex-grow-1 px-4 pt-4 pb-5">
				<div class="container-fluid">

					<div class="d-flex justify-content-between align-items-center mb-4">
						<!-- 소제목 -->
						<h2 class="h3 fw-bold text-primary-dark mb-0">
							<i class="bi bi-file-earmark-check me-2"></i> 결재 문서 작성
						</h2>
					</div>




					<div class="tudio-scope">
						<div class="d-flex justify-content-between align-items-end mb-0">
							<ul class="nav nav-tabs custom-index-tabs border-0 mb-0">
								<li class="nav-item">
									<button class="nav-link active" type="button">
										<i class="bi bi-pencil-fill"></i> <span>기안서 작성</span>
									</button>
								</li>
							</ul>
						</div>

						<div class="tab-content-card p-4">
							<form id="approvalForm">
								<div class="row mb-4">
									<div class="col-md-7">
										<table
											class="table table-bordered align-middle mb-0 custom-table table-hover-custom"
											style="height: 100%;">
											<tr>
												<th class="bg-light text-center" style="width: 25%;">프로젝트<span
													class="text-danger">*</span></th>
												<td><select name="projectNo" id="projectSelect"
													class="form-select form-select-sm">
														<option value="0">-- 프로젝트 선택 --</option>
														<c:forEach items="${myProjectList}" var="p">
															<option value="${p.projectNo}"
																${p.projectNo == projectNo ? 'selected' : ''}>
																${p.projectName}</option>
														</c:forEach>
												</select></td>
											</tr>
											<tr>
												<th class="bg-light text-center">기안자</th>
												<td class="small">${loginUser.memberName} <span
													class="text-muted"> (<c:out
															value="${loginUser.memberDepartment}" default="부서미지정" />
														/ <c:out value="${loginUser.memberPosition}"
															default="직책미지정" />)
												</span>
												</td>
											</tr>
											<tr>
												<th class="bg-light text-center">기안일자</th>
												<td class="small" id="currentDate"></td>
											</tr>
											<tr>
												<th class="bg-light text-center">보안</th>
												<td>
													<div class="d-flex gap-3 small">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																name="security" id="secPublic" value="Y" checked>
															<label class="form-check-label" for="secPublic">공개
																<span class="text-muted">(모두 조회 가능)</span>
															</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																name="security" id="secPrivate" value="N"> <label
																class="form-check-label" for="secPrivate">비공개 <span
																class="text-muted">(결재자만 가능)</span></label>
														</div>
													</div>
												</td>
											</tr>
										</table>
									</div>

									<div class="col-md-5">
										<div
											class="d-flex justify-content-end align-items-start gap-1">
											<div class="border text-center" style="width: 80px;">
												<div class="bg-light border-bottom p-1 small">기안</div>
												<div
													class="p-2 d-flex align-items-center justify-content-center"
													style="height: 60px;">${userName}</div>
												<div class="bg-light border-top p-1 small">완료</div>
											</div>

											<c:forEach var="i" begin="1" end="5">
												<div class="border text-center approver-slot" id="slot-${i}"
													style="width: 80px; position: relative;">
													<div class="bg-light border-bottom p-1 small">승인</div>
													<div
														class="p-2 d-flex align-items-center justify-content-center slot-name"
														style="height: 60px; font-size: 0.85rem;">
														<span class="text-muted" style="cursor: pointer;"
															onclick="openApproverModal()">지정</span>
													</div>
													<input type="hidden" class="mem-no" value="">
													<div class="bg-light border-top p-1 small">&nbsp;</div>
												</div>
											</c:forEach>
										</div>
										<div class="text-end mt-2">
											<button type="button" class="btn btn-xs btn-outline-primary"
												onclick="openApproverModal()">
												<i class="bi bi-person-plus"></i> 결재선 지정
											</button>
										</div>
									</div>
								</div>

								<div class="mb-4">
									<label class="fw-bold mb-2">제목 <span
										class="text-danger">*</span>
									</label>
									<div class="row g-2">
										<div class="col-3">
											<select class="form-select" id="docType"
												onchange="changeTemplate(this.value)">
												<option value="">-- 양식 선택 --</option>
												<option value="resource">자원/인력 투입요청</option>
												<option value="schedule">일정변경요청</option>
												<option value="budget">예산조정요청</option>
												<option value="check">검수 및 보고</option>
												<option value="report">최종 완료 보고</option>
												<option value="other">기타</option>
											</select>
										</div>
										<div class="col-9">
											<input type="text" name="documentTitle" class="form-control"
												id="docTitle" placeholder="제목을 입력하세요">
										</div>
									</div>
								</div>

								<div class="mb-4">
									<label class="fw-bold mb-2">상세 내용 <span
										class="text-danger">*</span></label>
									<div id="editor"></div>
								</div>

								<div class="p-3 border rounded bg-light">
									<button type="button"
										class="btn btn-sm btn-outline-secondary mb-2">
										<i class="bi bi-paperclip"></i> 파일 첨부
									</button>
									<div class="text-muted small">첨부된 파일이 없습니다.</div>
								</div>
							</form>
						</div>

						<div class="d-flex justify-content-between mt-4 border-top pt-3">
							<button type="button" class="tudio-btn tudio-btn-outline"
								onclick="history.back()">취소</button>
							<div class="gap-2 d-flex">
								<button type="button" class="tudio-btn tudio-btn-light">임시저장</button>
								<button type="button" class="tudio-btn tudio-btn-primary"
									id="btnSubmit">결재상신</button>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>
		<div class="modal fade" id="approvalLineModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content tudio-modal-content">
            <div class="modal-header tudio-modal-header">
                <h5 class="modal-title fw-bold text-primary-dark">
                    <i class="bi bi-person-gear me-2"></i>결재선 지정
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body p-4">
                <div class="row g-4">
                    <div class="col-md-6 border-end">
                        <div class="todo-input-box mb-3">
                            <i class="bi bi-search text-muted me-2"></i>
                            <input type="text" id="approverSearch" class="todo-real-input" placeholder="이름을 검색하세요..." onkeyup="filterApprovers()">
                        </div>
                        
                        <div class="todo-list-area" id="accordionContainer">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-info-circle mb-2 d-block" style="font-size: 2rem;"></i>
                                <p>프로젝트를 선택하면<br>결재 가능한 목록이 표시됩니다.</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 bg-light-subtle rounded-3">
                        <div class="d-flex justify-content-between align-items-center mb-3 px-2">
                            <label class="form-label small fw-bold text-muted mb-0">지정된 결재선 (최대 5명)</label>
                            <button type="button" class="btn btn-sm btn-link text-danger text-decoration-none" onclick="clearSelectedList()">전체삭제</button>
                        </div>
                        <div class="todo-list-area" id="selectedApproverArea">
                            </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer tudio-modal-footer">
                <button type="button" class="tudio-btn tudio-btn-outline" data-bs-dismiss="modal">취소</button>
                <button type="button" class="tudio-btn tudio-btn-primary" onclick="confirmApprovalLine()">설정완료</button>
            </div>
        </div>
    </div>
</div>
	</section>
	<script type="text/javascript">
const contextPath = "/tudio";
let myEditor;

$(document).ready(function() {
    // 1. 에디터 초기화
    ClassicEditor
        .create(document.querySelector('#editor'), {
            language: 'ko'
        })
        .then(editor => { 
            myEditor = editor; 
            console.log("Editor initialized");
        })
        .catch(error => { console.error(error); });
}); 

const now = new Date();
const formattedDate = now.getFullYear() + "-" + (now.getMonth() + 1).toString().padStart(2, '0') + "-" + now.getDate().toString().padStart(2, '0');
$("#currentDate").text(formattedDate);


function setApproverList(selectedMembers) {
    // selectedMembers는 [{memNo: 18, name: '이름'}, ...] 형태의 배열
    
    // 일단 칸을 초기화
    $(".slot-name").html('<span class="text-muted" style="cursor:pointer;" onclick="openApproverModal()">지정</span>');
    $(".approver-slot input").val("");

    selectedMembers.forEach((member, index) => {
        if(index < 5) { // 최대 5명까지
            let slot = $("#slot-" + (index + 1));
            slot.find(".slot-name").text(member.name);
            slot.find(".mem-no").val(member.memNo);
        }
    });
}

// 2. 양식 변경 함수
function changeTemplate(val) {
    // 공통 상단 테이블 (실무 느낌의 뼈대)
    var getCommonHeader = function(title) {
        var header = "";
        header += "<h2 style='text-align:center;'>" + title + "</h2>";
        header += "<br>";
        header += "<table border='1' style='width:100%; border-collapse:collapse; margin-bottom:20px;'>";
        header += "    <tr>";
        header += "        <th style='width:15%; background-color:#f8f9fa;'>프로젝트명</th>";
        header += "        <td style='width:35%; padding:8px;'></td>";
        header += "        <th style='width:15%; background-color:#f8f9fa;'>기안일자</th>";
        header += "        <td style='width:35%; padding:8px;'></td>"; // 날짜 칸은 비워둠 (직접 입력 혹은 수동 작성)
        header += "    </tr>";
        header += "    <tr>";
        header += "        <th style='background-color:#f8f9fa;'>기안자</th>";
        header += "        <td style='padding:8px;'>${loginUser.memberName}</td>";
        header += "        <th style='background-color:#f8f9fa;'>소속부서</th>";
        header += "        <td style='padding:8px;'>${loginUser.memberDepartment}</td>";
    header += "    </tr>";
        header += "</table>";
        return header;
    };

    const templates = {
        resource: getCommonHeader("[자원 / 인력 투입 요청]") + `
            <p><strong>1. 투입 목적</strong></p>
            <p>- </p>
            <p><strong>2. 투입 요청 상세</strong></p>
            <table border="1" style="width:100%; border-collapse:collapse;">
                <thead style="background-color:#f8f9fa;">
                    <tr>
                        <th style="width:20%;">구분</th>
                        <th style="width:30%;">필요 인원/자원</th>
                        <th style="width:30%;">투입 기간</th>
                        <th style="width:20%;">비고</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="height:30px; text-align:center;">인력</td><td></td><td></td><td></td></tr>
                    <tr><td style="height:30px; text-align:center;">장비/기타</td><td></td><td></td><td></td></tr>
                </tbody>
            </table>
        `,
        schedule: getCommonHeader("[일정 변경 요청]") + `
            <p><strong>1. 변경 사유</strong></p>
            <p>- </p>
            <p><strong>2. 일정 변경 대비</strong></p>
            <table border="1" style="width:100%; border-collapse:collapse;">
                <thead style="background-color:#f8f9fa;">
                    <tr>
                        <th style="width:30%;">구분</th>
                        <th style="width:35%;">기존 일정</th>
                        <th style="width:35%;">변경(안)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="height:30px; text-align:center;">착수일</td><td></td><td></td></tr>
                    <tr><td style="height:30px; text-align:center;">종료일</td><td></td><td></td></tr>
                </tbody>
            </table>
        `,
        budget: getCommonHeader("[예산 조정 요청]") + `
            <p><strong>1. 조정 사유</strong></p>
            <p>- </p>
            <p><strong>2. 예산 조정 내역 (단위: 원)</strong></p>
            <table border="1" style="width:100%; border-collapse:collapse;">
                <thead style="background-color:#f8f9fa;">
                    <tr>
                        <th>항목</th>
                        <th>기존 예산</th>
                        <th>조정 금액</th>
                        <th>최종 예산</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="height:30px;"></td><td></td><td></td><td></td></tr>
                </tbody>
            </table>
        `,
        check: getCommonHeader("[검수 및 보고]") + `
            <p><strong>1. 검수 대상</strong></p>
            <p>- </p>
            <p><strong>2. 검수 결과 요약</strong></p>
            <table border="1" style="width:100%; border-collapse:collapse;">
                <tr>
                    <th style="width:30%; background-color:#f8f9fa;">검수 결과</th>
                    <td style="padding:10px;">■ 적합 / □ 보완필요 / □ 부적합</td>
                </tr>
                <tr>
                    <th style="background-color:#f8f9fa;">주요 이슈</th>
                    <td style="padding:10px; height:60px;"></td>
                </tr>
            </table>
        `,
        report: getCommonHeader("[최종 완료 보고]") + `
            <p><strong>1. 프로젝트 개요</strong></p>
            <p>- 수행 기간: </p>
            <p><strong>2. 최종 성과</strong></p>
            <p>- 주요 목표 달성 여부: </p>
            <p><strong>3. 향후 유지보수 계획</strong></p>
            <p>- </p>
        `,
        other: getCommonHeader("[기타 요청]") + `
            <p><strong>1. 요청 내용</strong></p>
            <div style="min-height:150px; border:1px solid #dee2e6; padding:10px;">
                여기에 상세 내용을 입력하세요.
            </div>
        `
    };

    if(val && myEditor) {
        // JSP에서 전달받은 로그인 사용자 정보를 여기에 바로 넣으려면 변수를 활용하세요
        // 예: getCommonHeader("제목", "${loginUser.memberName}", "${loginUser.memberDepartment}")
        myEditor.setData(templates[val]);
    }
}

// 3. 결재자 지정 (테스트용)
function openApproverModal() {
    let html = `
        <div class="border approver-row" style="width: 100px;">
            <input type="hidden" class="mem-no" value="202401"> 
            <div class="bg-light border-bottom p-1">승인</div>
            <div class="p-3">김철수</div>
        </div>
    `;
    $("#approverList").prepend(html);
}

// 4. 결재 상신
function submitApproval() {
	
    const projectNo = $("#projectSelect").val();
    if (projectNo === "0" || projectNo === "") {
        alert("관련 프로젝트를 선택해주세요.");
        $("#projectSelect").focus();
        return; // 함수 종료 (AJAX 실행 안 함)
    }

    const docType = $("#docType").val();
    if (docType === "") {
        alert("문서 양식을 선택해주세요. (없을 경우 '기타' 선택)");
        $("#docType").focus();
        return;
    }

    const docTitle = $("#docTitle").val().trim();
    if (docTitle === "") {
        alert("제목을 입력해주세요.");
        $("#docTitle").focus();
        return;
    }
	
    let approvalList = [];
    $(".approver-row").each(function(index) {
        approvalList.push({
            memberNo: $(this).find(".mem-no").val(),
            approvalStep: index + 1,
            approvalStatus: 607
        });
    });
    
    if(approvalList.length === 0) {
        alert("결재자를 지정해주세요.");
        return;
    }

    // [중요] input 태그에 id가 없을 수 있으므로 name 선택자도 함께 씁니다.
    let draftData = {
        projectNo: $("select[name='projectNo']").val(),
        documentType: 601, // 임시 코드값 (DB 공통코드에 맞게 수정)
        documentTitle: $("input[name='documentTitle']").val(),
        documentContent: myEditor.getData(),
        approvalList: approvalList
    };

    $.ajax({
        url: contextPath + "/approval/insert",
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(draftData),
        success: function(res) {
            if(res === "success") {
                alert("상신되었습니다.");
                location.href = contextPath + "/approval/list";
            } else if(res === "login_required") {
                alert("세션이 만료되었습니다. 다시 로그인해주세요.");
                location.href = contextPath + "/login"; // 로그인 페이지 경로에 맞게 수정
            } else {
                alert("저장 실패: " + res);
            }
        },
        error: function(xhr) {
            console.error(xhr);
            alert("서버 통신 오류가 발생했습니다.");
        }
    });
}

let allClientData = []; // 서버에서 가져온 전체 클라이언트 데이터 저장용
let selectedApprovers = []; // 오른쪽 리스트에 담긴 데이터

// 1. 모달 열기 (기존 함수 대체)
function openApproverModal() {
    const projectNo = $("#projectSelect").val();
    
    if (projectNo === "0" || projectNo === "") {
        alert("프로젝트를 먼저 선택해주세요!");
        $("#projectSelect").focus();
        return;
    }

    // 서버에서 데이터 가져오기
    $.ajax({
        url: contextPath + "/approval/getApproverList",
        type: "GET",
        data: { projectNo: projectNo },
        success: function(data) {
            allClientData = data;
            renderAccordion(data);
            new bootstrap.Modal(document.getElementById('approvalLineModal')).show();
        }
    });
}

// 2. 아코디언 렌더링 (부서별 그룹화)
function renderAccordion(data) {
    const container = $("#accordionContainer");
    container.empty();

    // 부서별로 데이터 묶기
    const grouped = data.reduce((acc, obj) => {
        const key = obj.memberDepartment || "부서미지정";
        if (!acc[key]) acc[key] = [];
        acc[key].push(obj);
        return acc;
    }, {});

    Object.keys(grouped).forEach((dept, index) => {
        const deptId = `dept-${index}`;
        let html = `
            <div class="accordion-item border-0 mb-2">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fw-bold bg-white text-dark py-2 shadow-none" type="button" 
                            data-bs-toggle="collapse" data-bs-target="#${deptId}" style="font-size: 0.9rem;">
                        <i class="bi bi-folder2-open me-2 text-primary"></i> ${dept} (${grouped[dept].length})
                    </button>
                </h2>
                <div id="${deptId}" class="accordion-collapse collapse" data-bs-parent="#accordionContainer">
                    <div class="accordion-body p-1">`;
        
        grouped[dept].forEach(mem => {
            const isDimmed = selectedApprovers.some(a => a.memberNo == mem.memberNo) ? 'opacity-50 pointer-events-none bg-light' : '';
            html += `
                <div class="todo-item-row d-flex align-items-center p-2 px-3 ${isDimmed}" id="mem-row-${mem.memberNo}">
                    <input type="checkbox" class="form-check-input custom-chk me-3" 
                           value="${mem.memberNo}" data-name="${mem.memberName}" 
                           data-pos="${mem.memberPosition}" data-dept="${dept}"
                           ${isDimmed ? 'disabled' : ''} onchange="toggleToRight(this)">
                    <div class="flex-grow-1">
                        <span class="fw-bold small">${mem.memberName}</span>
                        <span class="text-muted" style="font-size: 0.75rem;">${mem.memberPosition}</span>
                    </div>
                </div>`;
        });

        html += `</div></div></div>`;
        container.append(html);
    });
}

// 3. 체크 시 오른쪽으로 이동 (또는 직접 추가 버튼 연동 가능)
function toggleToRight(chk) {
    if (chk.checked) {
        if (selectedApprovers.length >= 5) {
            alert("결재선은 최대 5명까지입니다.");
            chk.checked = false;
            return;
        }
        const member = {
            memberNo: $(chk).val(),
            name: $(chk).data('name'),
            pos: $(chk).data('pos'),
            dept: $(chk).data('dept')
        };
        selectedApprovers.push(member);
        renderRightList();
        $(chk).closest('.todo-item-row').addClass('opacity-50 pointer-events-none bg-light');
        chk.disabled = true;
    }
}

// 4. 오른쪽 리스트 그리기 (X버튼 포함)
function renderRightList() {
    const area = $("#selectedApproverArea");
    area.empty();

    selectedApprovers.forEach((mem, idx) => {
        area.append(`
            <div class="todo-item-row d-flex align-items-center p-2 px-3 border shadow-sm mb-2 bg-white animate__animated animate__fadeInRight">
                <span class="approval-badge me-2">${idx + 1}</span>
                <div class="flex-grow-1">
                    <span class="fw-bold small">${mem.name}</span>
                    <span class="text-muted small"> | ${mem.dept}</span>
                </div>
                <button type="button" class="btn btn-sm btn-todo-del" onclick="removeApprover(${mem.memberNo})">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        `);
    });
}

// 5. 검색 필터링 (자동 열림 로직 포함)
function filterApprovers() {
    const val = $("#approverSearch").val().toLowerCase();
    
    if (val === "") {
        $(".accordion-collapse").collapse('hide');
        $(".todo-item-row").show();
        return;
    }

    $(".accordion-item").each(function() {
        let hasMatch = false;
        $(this).find(".todo-item-row").each(function() {
            const name = $(this).find(".fw-bold").text().toLowerCase();
            if (name.includes(val)) {
                $(this).show();
                hasMatch = true;
            } else {
                $(this).hide();
            }
        });

        if (hasMatch) {
            $(this).find(".accordion-collapse").collapse('show');
            $(this).show();
        } else {
            $(this).hide();
        }
    });
}

// 6. 삭제 및 최종 확인
function removeApprover(mNo) {
    selectedApprovers = selectedApprovers.filter(a => a.memberNo != mNo);
    renderRightList();
    $(`#mem-row-${mNo}`).removeClass('opacity-50 pointer-events-none bg-light').find('input').prop('disabled', false).prop('checked', false);
}

function confirmApprovalLine() {
    if (selectedApprovers.length === 0) {
        alert("결재자를 한 명 이상 선택해주세요.");
        return;
    }
    // form.jsp의 메인 슬롯 업데이트 함수 호출
    setApproverList(selectedApprovers.map(a => ({ memNo: a.memberNo, name: a.name })));
    bootstrap.Modal.getInstance(document.getElementById('approvalLineModal')).hide();
}

// 버튼 클릭 이벤트 연결
$(function() {
    // "결재상신" 버튼 클래스를 가진 요소를 클릭했을 때 실행
    $("#btnSubmit").on("click", submitApproval);
});
</script>
</body>
</html>