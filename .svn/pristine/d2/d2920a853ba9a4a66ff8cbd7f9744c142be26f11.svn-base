package kr.or.ddit.projectMember.service.impl;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import kr.or.ddit.projectMember.mapper.IProjectMemberMapper;
import kr.or.ddit.projectMember.service.IProjectMemberService;
import kr.or.ddit.vo.project.ProjectMemberVO;
import lombok.extern.slf4j.Slf4j;


@Slf4j
@Service
public class ProjectMemberServiceImpl implements IProjectMemberService {

	@Autowired
	private IProjectMemberMapper projectMemberMapper;
	
	/**
	 *  구성원 목록 조회
	 */
	@Override
	public List<ProjectMemberVO> projectMemberList(int projectNo) {
		
		return projectMemberMapper.projectMemberList(projectNo);
	}

	
	/**
	 * 구성원 정보 조회
	 */
	@Override
	public ProjectMemberVO projectMemberDetail(ProjectMemberVO vo) {
		ProjectMemberVO memberInfo = projectMemberMapper.projectMemberDetail(vo);  			 // 이름/이메일/참여일 등
		ProjectMemberVO cnt = projectMemberMapper.projectMemberDetailTaskCount(vo);          // total/ing/done

		    if (memberInfo == null) return null;

		    // cnt가 null일 수 있으니 방어
		    memberInfo.setTotalCnt(cnt == null ? 0 : cnt.getTotalCnt());
		    memberInfo.setIngCnt(cnt == null ? 0 : cnt.getIngCnt());
		    memberInfo.setDoneCnt(cnt == null ? 0 : cnt.getDoneCnt());
		    memberInfo.setTaskCnt(cnt == null ? 0 : cnt.getTaskCnt());
		    memberInfo.setTaskSubCnt(cnt == null ? 0 : cnt.getTaskSubCnt());
		    memberInfo.setIngSubCnt(cnt == null ? 0 : cnt.getIngSubCnt());

		    return memberInfo;
	}

	
	/**
	 *  프로젝트 내 구성원 수
	 */
	@Override
	public int projectMemberCount(int projectNo) {
		return projectMemberMapper.projectMemberCount(projectNo);
	}


	@Override
	public ProjectMemberVO projectMemberDetailTaskCount(ProjectMemberVO vo) {
		return projectMemberMapper.projectMemberDetailTaskCount(vo);
	}


	@Override
	public List<ProjectMemberVO> projectMemberDetailTaskCountChart(int projectNo) {
		return projectMemberMapper.projectMemberDetailTaskCountChart(projectNo);
	}


	@Override
	public List<ProjectMemberVO> projectMemberListSearch(Map<String, Object> param) {
		
		return projectMemberMapper.projectMemberListSearch(param);
	}

}
	

