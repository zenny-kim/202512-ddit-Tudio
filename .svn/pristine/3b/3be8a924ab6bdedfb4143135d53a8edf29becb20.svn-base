<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tudio</title>
	
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/header.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/footer.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/member.css">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="${pageContext.request.contextPath}/js/common.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.all.min.js"></script></head>

<body>
    <div class="login-container shadow">
        <h2 class="text-center login-title">Tudio</h2>

        <form id="loginForm" action="${pageContext.request.contextPath}/login" method="POST">
            <div class="mb-3">
                <label for="username" class="form-label fw-bold">아이디</label>
                <input type="text" class="form-control login-input" id="username" name="username" placeholder="아이디를 입력하세요" required>
            </div>
            <div class="mb-4">
                <label for="password" class="form-label fw-bold">비밀번호</label>
                <input type="password" class="form-control login-input" id="password" name="password" placeholder="비밀번호를 입력하세요" required>
                <div class="error-msg text-danger small mt-1" style="height: 20px;"></div>
            </div>
            <!-- 퀵로그인 -->
            <div class="text-center mb-4">
			    <p class="text-muted small mb-2">퀵로그인</p>
			    <div class="btn-group" role="group">
			        <button type="button" class="btn btn-outline-info" onclick="quickLogin('a002', '1234')">
			            <i class="bi bi-person-fill-check"></i>사용자
			        </button>
			        <button type="button" class="btn btn-outline-info" onclick="quickLogin('a1234', '1234')">
			            <i class="bi bi-person-badge"></i>기업
			        </button>
			        <button type="button" class="btn btn-outline-info" onclick="quickLogin('a001', '1234')">
			            <i class="bi bi-person-gear"></i>관리자
			        </button>
			    </div>
			</div>
			<!-- 퀵로그인 -->
            <div class="d-grid gap-2 mb-3">
                <button type="submit" class="btn btn-primary btn-lg">로그인</button>
            </div>

            <div class="d-flex justify-content-center mb-3">
                <a href="${pageContext.request.contextPath}/tudio/findMemberId" class="text-decoration-none text-muted small mx-2">아이디 찾기</a>
                <span class="text-muted small">|</span>
                <a href="${pageContext.request.contextPath}/tudio/findMemberPw" class="text-decoration-none text-muted small mx-2">비밀번호 찾기</a>
            </div>

            <hr class="my-4">
            
            <div class="text-center">
                <p class="text-muted small">아직 계정이 없으신가요?</p>
                <button type="button" class="btn btn-outline-secondary w-100" 
                        onclick="location.href='${pageContext.request.contextPath}/tudio/memberType'">회원가입</button>
            </div>
        </form>
    </div>
<jsp:include page="/WEB-INF/views/include/footer.jsp"/>
<script src="${pageContext.request.contextPath}/js/footer.js"></script>  
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
$(function() {
    // 1. 사용할 요소들을 변수에 미리 담아둡니다 (성능 최적화)
    const $loginInput = $(".login-input");  // 아이디, 비밀번호 입력창
    const $errorText = $(".error-msg");     // 화면에 빨간색으로 뜰 에러 메시지
    const $loginForm = $("#loginForm");           // 로그인 폼 전체
    
    const urlParams = new URLSearchParams(window.location.search);
    const errorMsg = urlParams.get('message'); // 'message' 키값의 내용을 가져옴
    
    if (errorMsg) {
        Swal.fire({
            icon: 'error',
            title: '로그인 실패',
            text: errorMsg,
            confirmButtonColor: '#3085d6',
            confirmButtonText: '확인'
        });
        //알럿창 띄운 후 url 파라미터 지우기
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    // 3. 입력창 이벤트 처리
    $loginInput.on("keydown click", function(event) {
        $errorText.html("");
        
        // 3-2. CapsLock 상태 체크 (비밀번호 입력 시 유용)
        if (event.originalEvent && typeof event.originalEvent.getModifierState === "function") {
            if (event.originalEvent.getModifierState("CapsLock")) {
                $errorText.html("⚠️ CapsLock이 켜져 있습니다.");
            }
        }
        
        // 3-3. Enter 키(13번)를 누르면 바로 폼을 전송(Submit)합니다.
        if (event.which === 13) {
            $loginForm.submit();
        }
    });
});

//퀵로그인 기능 - 구현 시 수정하거나 삭제
function quickLogin(userId, userPw) {
    // 1. 아이디와 비밀번호 input을 찾아서 값을 넣어줍니다.
    $("#username").val(userId);
    $("#password").val(userPw);
    
    // 2. 값이 채워졌으므로 기존 에러 메시지는 지워줍니다.
    $(".error-msg").html("");
    
    // 3. (선택사항) 값을 넣자마자 바로 로그인을 실행하고 싶다면 아래 주석을 해제하세요.
    // $("#loginForm").submit();
    
    // 4. 시각적인 피드백을 위해 간단한 알림을 띄울 수도 있습니다.
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 1000,
        timerProgressBar: true
    });
    
    Toast.fire({
        icon: 'success',
        title: userId + ' 계정 정보 입력됨'
    });
}
</script>
</html>