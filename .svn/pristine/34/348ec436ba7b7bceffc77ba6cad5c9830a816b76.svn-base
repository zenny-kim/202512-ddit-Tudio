<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core"%>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Tudio - 공지시항</title>
	<jsp:include page="/WEB-INF/views/include/common.jsp" />
	<link rel="stylesheet" href="${pageContext.request.contextPath}/css/project_common.css">
</head>
<body class="d-flex flex-column min-vh-100">
	<jsp:include page="../include/headerUser.jsp" />

	<div class="d-flex flex-grow-1">
	
		<jsp:include page="../include/sidebarCs.jsp" >
			<jsp:param name="menu" value="notice" />
		</jsp:include>
		
		<jsp:useBean id="now" class="java.util.Date" />
		<fmt:formatDate value="${now}" pattern="yyyy-MM-dd" var="todayStr" />

		<main class="main-content-wrap fkex-grow-1">
			<div class="container-fluid px-4 pt-4">
		    	<h2 class="h3 fw-bold text-primary-dark m-0">
		    		<i class="bi bi-megaphone-fill me-2"></i>TUDIO 공지사항
		    	</h2>

					<form id="searchForm" action="${pageContext.request.contextPath}/tudio/notice/list" method="get">
						<input type="hidden" name="page" id="page" value="${pagingVO.currentPage}" />

						<div class="d-flex justify-content-end mb-3">
							<div class="input-group" style="width: 300px;">
								<input type="text" name="searchWord" class="form-control" value="${pagingVO.searchWord}" placeholder="제목 검색">
								<button type="button" class="btn btn-primary" onclick="fn_search(1)">
									<i class="bi bi-search"></i>
								</button>
							</div>
						</div>
					</form>

					<div class="card mb-4 border-0 shadow-sm">
						<div class="card-body p-0">
							<table class="table table-hover align-middle mb-0">
								<thead class="table-light">
									<tr class="text-center">
										<th style="width: 8%">No</th>
										<th style="width: 50%">제목</th>
										<th style="width: 15%">작성일</th>
										<th style="width: 15%">작성자</th>
										<th style="width: 10%">조회수</th>
									</tr>
								</thead>
								<tbody>
							<c:choose>
								<c:when test="${empty pagingVO.dataList}">							
									<tr>
										<td colspan="5" class="text-center py-5 text-muted">등록된 공지사항이 없습니다.</td>
									</tr>
								</c:when>
								<c:otherwise>
									<c:forEach items="${pagingVO.dataList}" var="notice" varStatus="vs">
										<fmt:formatDate value="${notice.noticeRegdate}" pattern="yyyy-MM-dd" var="regDateStr"/>
										
										<tr class="${notice.noticePinStatus eq 'Y' ? 'bg-light fw-bold' : ''}">
											<td class="text-center">
										<c:choose>
											<c:when test="${notice.noticePinStatus eq 'Y'}">
												<i class="bi bi-pin-angle-fill text-danger"></i>
											</c:when>
											<c:otherwise>
	                                             ${pagingVO.totalRecord - ((pagingVO.currentPage - 1) * pagingVO.screenSize) - vs.index}
	                                    	</c:otherwise>
										</c:choose>
											</td>
											<td>
												<a href="${pageContext.request.contextPath}/tudio/notice/detail?noticeNo=${notice.noticeNo}" class="text-decoration-none text-dark d-block text-truncate">
													${notice.noticeTitle}
													<c:if test="${todayStr eq regDateStr}">
													    <span class="badge bg-warning text-dark ms-2 shadow-sm" style="font-size: 0.65rem; vertical-align: middle;">NEW</span>
													</c:if>
	
	                                            	<c:if test="${notice.noticeFileNo > 0}">
	                                                	<i class="bi bi-paperclip text-muted ms-2" title="첨부파일 있음"></i>
	                                            	</c:if>
												</a>
											</td>
											<td class="text-center text-muted small">
												<fmt:formatDate value="${notice.noticeRegdate}" pattern="yyyy-MM-dd" />
											</td>
											<td class="text-center">
												<span class="badge bg-light text-dark border">
													<i class="bi bi-person-fill me-1"></i>${notice.writer}
												</span>
											</td>
											<td class="text-center text-muted small">${notice.noticeHit}</td>
										</tr>
										</c:forEach>
									</c:otherwise>
								</c:choose>
							</tbody>
						</table>
					</div>
				</div>

				<div id="pagingArea" class="d-flex justify-content-center mt-4">
			        ${pagingVO.pagingHTML}
			    </div>		
			</div>
		</main>
	</div>
	
	<jsp:include page="/WEB-INF/views/include/footer.jsp"/>

	<script>
	    // 검색 버튼 클릭 시 (1페이지부터 다시 검색)
	    function fn_search(pageNo) {
	        document.getElementById("page").value = pageNo;
	        document.getElementById("searchForm").submit();
	    }
	
	    // 페이징 번호 클릭 이벤트
	    document.addEventListener("DOMContentLoaded", function() {
	        const pagingArea = document.getElementById("pagingArea");
	        
	        pagingArea.addEventListener("click", function(e) {
	            // 클릭된 요소가 a태그 혹은 그 자식일 경우
	            const target = e.target.closest("a.page-link");
	            
	            if (target) {
	                e.preventDefault(); // href 이동 방지
	                const pageNo = target.getAttribute("data-page");
	                
	                if (pageNo) {
	                    fn_search(pageNo);
	                }
	            }
	        });
	    });
	</script>
</body>
</html>