<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.notice.mapper.INoticeMapper">

	<select id="selectUserNoticeList" parameterType="kr.or.ddit.vo.PaginationInfoVO" resultType="kr.or.ddit.vo.NoticeVO">
        SELECT B.*
        FROM (
            SELECT 
                ROW_NUMBER() OVER (
                    ORDER BY 
                        CASE WHEN A.NOTICE_PIN_STATUS = 'Y' THEN 1 ELSE 2 END ASC,
                        A.NOTICE_REGDATE DESC
                ) AS RNUM,
                A.*
            FROM (
                SELECT 
                    N.NOTICE_NO
                    , N.NOTICE_TITLE
                    , N.NOTICE_HIT
                    , N.NOTICE_REGDATE
                    , N.NOTICE_PIN_STATUS
                    , N.NOTICE_FILE_NO
                    , N.MEMBER_NO          
                    , M.MEMBER_ID AS WRITER 
                FROM NOTICE N
                LEFT JOIN MEMBER M ON N.MEMBER_NO = M.MEMBER_NO
                WHERE 1=1
                <if test="searchWord != null and searchWord != ''">
                    AND N.NOTICE_TITLE LIKE '%' || #{searchWord} || '%'
                </if>
            ) A
        ) B
        <![CDATA[
            WHERE RNUM >= #{startRow} AND RNUM <= #{endRow}
        ]]>
    </select>

    <select id="selectNoticeCount" parameterType="kr.or.ddit.vo.PaginationInfoVO" resultType="int">
        SELECT COUNT(*)
        FROM NOTICE
        WHERE 1=1
        <if test="searchWord != null and searchWord != ''">
            AND NOTICE_TITLE LIKE '%' || #{searchWord} || '%'
        </if>
    </select>
    
    <update id="incrementNoticeHit" parameterType="int">
        UPDATE NOTICE 
        SET NOTICE_HIT = NOTICE_HIT + 1 
        WHERE NOTICE_NO = #{noticeNo}
    </update>

    <select id="selectNoticeDetail" parameterType="int" resultType="kr.or.ddit.vo.NoticeVO">
        SELECT 
            N.NOTICE_NO
            , N.NOTICE_TITLE
            , N.NOTICE_CONTENT
            , N.NOTICE_REGDATE
            , N.NOTICE_UPDDATE
            , N.NOTICE_HIT
            , N.NOTICE_FILE_NO
            , N.NOTICE_PIN_STATUS
            , M.MEMBER_ID AS WRITER
        FROM NOTICE N
        LEFT JOIN MEMBER M ON N.MEMBER_NO = M.MEMBER_NO
        WHERE N.NOTICE_NO = #{noticeNo}
    </select>
    
    <update id="incrementFileDownloadCnt" parameterType="int">
    	UPDATE FILE_DETAIL
    	SET FILE_DOWNLOAD_CNT = FILE_DOWNLOAD_CNT + 1
    	WHERE FILE_NO = #{fileNo}
    </update>

</mapper>